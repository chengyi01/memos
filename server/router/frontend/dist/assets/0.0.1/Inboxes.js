import{q as k,o as v,u as g,a as D,X as F,Y as B,Z as U,s as _,N as n,j as e,c as j,_ as m,$ as d,a0 as u,a1 as x,a2 as r,d as $,a3 as y,a4 as H,l as z,p as O,a5 as L,E as P,a6 as V}from"./index.js";import{r as i}from"./leaflet-vendor.js";import{M as q}from"./message-circle.js";import{s as W}from"./utils-vendor.js";import"./mermaid-vendor.js";import"./katex-vendor.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Y=k("inbox",X),Z=v(({inbox:s})=>{const a=g(),c=D(),[l,t]=i.useState(void 0),[f,N]=i.useState(void 0),[w,b]=i.useState(!1),[E,M]=i.useState(!1);F(async()=>{if(s.activityId)try{const o=await B.getActivity({name:`${U}${s.activityId}`});if(o.payload?.memoComment){const A=o.payload.memoComment,S=await _.getOrFetchMemoByName(A.relatedMemo,{skipStore:!0});t(S);const R=await n.getOrFetchUserByName(s.sender);N(R),b(!0)}}catch(o){console.error("Failed to fetch activity:",o),M(!0);return}},[s.activityId]);const I=async()=>{l&&(c(`/${l.name}`),s.status===r.UNREAD&&h(!0))},h=async(o=!1)=>{await n.updateInbox({name:s.name,status:r.ARCHIVED},["status"]),o||y.success(a("message.archived-successfully"))},C=async()=>{await n.deleteInbox(s.name),y.success(a("message.deleted-successfully"))},p=()=>e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsx(m,{children:e.jsxs(d,{children:[e.jsx(u,{children:e.jsx(H,{className:"w-4 h-auto cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>C()})}),e.jsx(x,{children:e.jsx("p",{children:a("common.delete")})})]})})})}),T=()=>e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsx(m,{children:e.jsxs(d,{children:[e.jsx(u,{children:e.jsx(Y,{className:"w-4 h-auto cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>h()})}),e.jsx(x,{children:e.jsx("p",{children:a("common.archive")})})]})})})});return e.jsxs("div",{className:"w-full flex flex-row justify-start items-start gap-3",children:[e.jsx("div",{className:j("shrink-0 mt-2 p-2 rounded-full border",s.status===r.UNREAD?"border-primary text-primary bg-primary/10":"border-muted-foreground text-muted-foreground bg-popover"),children:e.jsx(m,{children:e.jsxs(d,{children:[e.jsx(u,{children:e.jsx(q,{className:"w-4 sm:w-5 h-auto"})}),e.jsx(x,{children:e.jsx("p",{children:"Comment"})})]})})}),e.jsx("div",{className:j("border w-full p-2 px-3 rounded-lg flex flex-col justify-start items-start gap-1 border-border hover:bg-background",s.status!==r.UNREAD&&"opacity-60"),children:w?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s.createTime?.toLocaleString()}),s.status===r.UNREAD?T():p()]}),e.jsx("p",{className:"text-base leading-tight cursor-pointer text-muted-foreground hover:underline hover:text-primary",onClick:I,children:a("inbox.memo-comment",{user:f?.displayName||f?.username,memo:l?.name,interpolation:{escapeValue:!1}})})]}):E?e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:a("inbox.failed-to-load")}),p()]}):e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-2",children:e.jsx($,{className:"animate-spin text-muted-foreground"})})})]})}),te=v(()=>{const s=g(),{md:a}=z(),c=W(n.state.inboxes,t=>t.status===r.UNREAD?0:t.status===r.ARCHIVED?1:2),l=async()=>{try{await n.fetchInboxes()}catch(t){console.error("Failed to fetch inboxes:",t)}};return i.useEffect(()=>{l()},[]),e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!a&&e.jsx(O,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-background text-foreground",children:[e.jsx("div",{className:"relative w-full flex flex-row justify-between items-center",children:e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(L,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:s("common.inbox")})]})}),e.jsxs("div",{className:"w-full h-auto flex flex-col justify-start items-start px-2 pb-4",children:[c.length===0&&e.jsxs("div",{className:"w-full mt-4 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(P,{}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:s("message.no-data")})]}),e.jsx("div",{className:"flex flex-col justify-start items-start w-full mt-4 gap-4",children:c.map(t=>{if(t.type===V.MEMO_COMMENT)return e.jsx(Z,{inbox:t},`${t.name}-${t.status}`)})})]})]})})]})});export{te as default};
