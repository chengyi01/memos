import{o as f,u as x,e as p,w as h,R as w,j as e,z as g,y as j,B as y,C as v,D as I,F as N,h as P,n as b}from"./index.js";import{r as a}from"./leaflet-vendor.js";import{A as U}from"./AuthFooter.js";import{P as S}from"./PasswordSignInForm.js";import"./mermaid-vendor.js";import"./utils-vendor.js";import"./katex-vendor.js";import"./ThemeSelect.js";const E=f(()=>{const r=x(),l=p(),[i,c]=a.useState([]),s=h.state.generalSetting;a.useEffect(()=>{l&&(window.location.href=w.ROOT)},[]),a.useEffect(()=>{(async()=>{const{identityProviders:n}=await v.listIdentityProviders({});c(n)})()},[]);const d=async t=>{const n=`auth.signin.${t.title}-${I(t.name)}`;if(t.type===N.OAUTH2){const m=P("/auth/callback"),o=t.config?.oauth2Config;if(!o){b.error("Identity provider configuration is invalid.");return}const u=`${o.authUrl}?client_id=${o.clientId}&redirect_uri=${encodeURIComponent(m)}&state=${n}&response_type=code&scope=${encodeURIComponent(o.scopes.join(" "))}`;window.location.href=u}};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-svh mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:s.customProfile?.logoUrl||"/logo.webp",alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-foreground opacity-80",children:s.customProfile?.title||"Memos"})]}),s.disallowPasswordAuth?i.length==0&&e.jsx("p",{className:"w-full text-2xl mt-2 text-muted-foreground",children:"Password auth is not allowed."}):e.jsx(S,{}),!s.disallowUserRegistration&&!s.disallowPasswordAuth&&e.jsxs("p",{className:"w-full mt-4 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:r("auth.sign-up-tip")}),e.jsx(g,{to:"/auth/signup",className:"cursor-pointer ml-2 text-primary hover:underline",viewTransition:!0,children:r("common.sign-up")})]}),i.length>0&&e.jsxs(e.Fragment,{children:[!s.disallowPasswordAuth&&e.jsxs("div",{className:"relative my-4 w-full",children:[e.jsx(j,{}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"bg-background px-2 text-xs text-muted-foreground",children:r("common.or")})})]}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:i.map(t=>e.jsx(y,{className:"bg-background w-full",variant:"outline",onClick:()=>d(t),children:r("common.sign-in-with",{provider:t.title})},t.name))})]})]}),e.jsx(U,{})]})});export{E as default};
