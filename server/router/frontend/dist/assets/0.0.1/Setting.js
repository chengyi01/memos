import{p as E,aa as Ge,ab as ls,ac as cs,j as e,ad as Ve,ae as ds,af as de,ag as we,ah as ms,ai as je,aj as us,ak as hs,al as xs,c as ye,u as S,U as le,b as Ne,am as $,an as z,ao as K,ap as H,aq as k,I as w,G as se,ar as q,B as N,n as y,H as I,o as Q,e as O,as as Z,K as G,at as ps,S as re,au as be,av as ke,aw as Ce,ax as Se,ay as V,az as J,a0 as ee,aA as fs,aB as gs,w as U,aC as P,aD as ve,aE as Pe,aF as js,aG as me,aH as R,N as We,aI as ce,aJ as vs,a1 as Ue,O as ws,aK as ys,z as Ns,a4 as te,a5 as ae,aL as bs,aM as ks,a6 as ne,a7 as ie,aN as he,aO as Cs,a9 as B,y as X,aP as Y,F as _,aQ as Re,h as Ss,C as oe,X as Be,Y as $e,Z as ze,_ as Ke,aR as xe,aS as M,aT as Us,aU as Ts,aV as Is,aW as Ee,k as As,aX as Ps,l as Rs,aY as Es,aZ as Ls,a_ as Ms}from"./index.js";import{r as f}from"./leaflet-vendor.js";import{s as Ds,J as F,K as Le}from"./utils-vendor.js";import{L as He,T as Te}from"./ThemeSelect.js";import{E as qe}from"./external-link.js";import"./mermaid-vendor.js";import"./katex-vendor.js";/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Os=E("circle-help",_s);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Gs=E("circle",Fs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],Ws=E("clipboard",Vs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],$s=E("clock",Bs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],Ks=E("cog",zs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],qs=E("database",Hs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Xs=E("key",Ys);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Js=E("monitor",Zs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],et=E("smartphone",Qs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]],tt=E("tablet",st);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],nt=E("user",at);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],ot=E("wifi",it);var Ie="Radio",[rt,Ye]=Ve(Ie),[lt,ct]=rt(Ie),Xe=f.forwardRef((s,a)=>{const{__scopeRadio:r,name:i,checked:t=!1,required:o,disabled:c,value:h="on",onCheck:x,form:l,...g}=s,[m,d]=f.useState(null),n=we(a,p=>d(p)),v=f.useRef(!1),C=m?l||!!m.closest("form"):!0;return e.jsxs(lt,{scope:r,checked:t,disabled:c,children:[e.jsx(de.button,{type:"button",role:"radio","aria-checked":t,"data-state":es(t),"data-disabled":c?"":void 0,disabled:c,value:h,...g,ref:n,onClick:je(s.onClick,p=>{t||x?.(),C&&(v.current=p.isPropagationStopped(),v.current||p.stopPropagation())})}),C&&e.jsx(Qe,{control:m,bubbles:!v.current,name:i,value:h,checked:t,required:o,disabled:c,form:l,style:{transform:"translateX(-100%)"}})]})});Xe.displayName=Ie;var Ze="RadioIndicator",Je=f.forwardRef((s,a)=>{const{__scopeRadio:r,forceMount:i,...t}=s,o=ct(Ze,r);return e.jsx(us,{present:i||o.checked,children:e.jsx(de.span,{"data-state":es(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:a})})});Je.displayName=Ze;var dt="RadioBubbleInput",Qe=f.forwardRef(({__scopeRadio:s,control:a,checked:r,bubbles:i=!0,...t},o)=>{const c=f.useRef(null),h=we(c,o),x=hs(r),l=xs(a);return f.useEffect(()=>{const g=c.current;if(!g)return;const m=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(m,"checked").set;if(x!==r&&n){const v=new Event("click",{bubbles:i});n.call(g,r),g.dispatchEvent(v)}},[x,r,i]),e.jsx(de.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...t,tabIndex:-1,ref:h,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Qe.displayName=dt;function es(s){return s?"checked":"unchecked"}var mt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ue="RadioGroup",[ut]=Ve(ue,[Ge,Ye]),ss=Ge(),ts=Ye(),[ht,xt]=ut(ue),as=f.forwardRef((s,a)=>{const{__scopeRadioGroup:r,name:i,defaultValue:t,value:o,required:c=!1,disabled:h=!1,orientation:x,dir:l,loop:g=!0,onValueChange:m,...d}=s,n=ss(r),v=ls(l),[C,p]=cs({prop:o,defaultProp:t??null,onChange:m,caller:ue});return e.jsx(ht,{scope:r,name:i,required:c,disabled:h,value:C,onValueChange:p,children:e.jsx(ds,{asChild:!0,...n,orientation:x,dir:v,loop:g,children:e.jsx(de.div,{role:"radiogroup","aria-required":c,"aria-orientation":x,"data-disabled":h?"":void 0,dir:v,...d,ref:a})})})});as.displayName=ue;var ns="RadioGroupItem",is=f.forwardRef((s,a)=>{const{__scopeRadioGroup:r,disabled:i,...t}=s,o=xt(ns,r),c=o.disabled||i,h=ss(r),x=ts(r),l=f.useRef(null),g=we(a,l),m=o.value===t.value,d=f.useRef(!1);return f.useEffect(()=>{const n=C=>{mt.includes(C.key)&&(d.current=!0)},v=()=>d.current=!1;return document.addEventListener("keydown",n),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",v)}},[]),e.jsx(ms,{asChild:!0,...h,focusable:!c,active:m,children:e.jsx(Xe,{disabled:c,required:o.required,checked:m,...x,...t,name:o.name,ref:g,onCheck:()=>o.onValueChange(t.value),onKeyDown:je(n=>{n.key==="Enter"&&n.preventDefault()}),onFocus:je(t.onFocus,()=>{d.current&&l.current?.click()})})})});is.displayName=ns;var pt="RadioGroupIndicator",os=f.forwardRef((s,a)=>{const{__scopeRadioGroup:r,...i}=s,t=ts(r);return e.jsx(Je,{...t,...i,ref:a})});os.displayName=pt;var ft=as,gt=is,jt=os;function Ae({className:s,...a}){return e.jsx(ft,{"data-slot":"radio-group",className:ye("grid gap-3",s),...a})}function W({className:s,...a}){return e.jsx(gt,{"data-slot":"radio-group-item",className:ye("border-border text-primary aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(jt,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Gs,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Me({open:s,onOpenChange:a,user:r,onSuccess:i}){const t=S(),[o,c]=f.useState(le.fromPartial({...r})),h=Ne(!1),x=!r;f.useEffect(()=>{c(r?le.fromPartial(r):le.fromPartial({}))},[r]);const l=m=>{c({...o,...m})},g=async()=>{if(x&&(!o.username||!o.password)){y.error("Username and password cannot be empty");return}try{if(h.setLoading(),x)await I.createUser({user:o}),y.success("Create user successfully");else{const m=[];o.username!==r?.username&&m.push("username"),o.password&&m.push("password"),o.role!==r?.role&&m.push("role"),await I.updateUser({user:o,updateMask:m}),y.success("Update user successfully")}h.setFinish(),i?.(),a(!1)}catch(m){console.error(m),y.error(m.details),h.setError()}};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:`${t(x?"common.create":"common.edit")} ${t("common.user")}`})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"username",children:t("common.username")}),e.jsx(w,{id:"username",type:"text",placeholder:t("common.username"),value:o.username,onChange:m=>l({username:m.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"password",children:t("common.password")}),e.jsx(w,{id:"password",type:"password",placeholder:t("common.password"),autoComplete:"off",value:o.password,onChange:m=>l({password:m.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:t("common.role")}),e.jsxs(Ae,{value:o.role,onValueChange:m=>l({role:m}),className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:se.USER,id:"user"}),e.jsx(k,{htmlFor:"user",children:t("setting.member-section.user")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:se.ADMIN,id:"admin"}),e.jsx(k,{htmlFor:"admin",children:t("setting.member-section.admin")})]})]})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:h.isLoading,onClick:()=>a(!1),children:t("common.cancel")}),e.jsx(N,{disabled:h.isLoading,onClick:g,children:t("common.confirm")})]})]})})}const vt=Q(()=>{const s=S(),a=O(),[r,i]=f.useState([]),t=Z(),o=Z(),[c,h]=f.useState(),x=Ds(r,"id"),[l,g]=f.useState(void 0),[m,d]=f.useState(void 0);f.useEffect(()=>{n()},[]);const n=async()=>{const u=await G.fetchUsers();i(u)},v=u=>u===se.HOST?"Host":u===se.ADMIN?s("setting.member-section.admin"):s("setting.member-section.user"),C=()=>{h(void 0),t.open()},p=u=>{h(u),o.open()},b=async u=>{g(u)},L=async()=>{if(!l)return;const u=l.username;await I.updateUser({user:{name:l.name,state:re.ARCHIVED},updateMask:["state"]}),g(void 0),ee.success(s("setting.member-section.archive-success",{username:u})),await n()},D=async u=>{const{username:T}=u;await I.updateUser({user:{name:u.name,state:re.NORMAL},updateMask:["state"]}),ee.success(s("setting.member-section.restore-success",{username:T})),await n()},A=async u=>{d(u)},j=async()=>{if(!m)return;const{username:u,name:T}=m;await G.deleteUser(T),d(void 0),ee.success(s("setting.member-section.delete-success",{username:u})),await n()};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.member-section.create-a-member")}),e.jsxs(N,{onClick:C,children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),s("common.create")]})]}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center mt-6",children:e.jsx("div",{className:"title-text",children:s("setting.member-list")})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full align-middle border border-border rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm font-semibold text-left text-foreground",children:[e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.username")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.role")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.nickname")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.email")}),e.jsx("th",{scope:"col",className:"relative py-2 pl-3 pr-4"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:x.map(u=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:[u.username,e.jsx("span",{className:"ml-1 italic",children:u.state===re.ARCHIVED&&"(Archived)"})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:v(u.role)}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:u.displayName}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:u.email}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm font-medium flex justify-end",children:a?.name===u.name?e.jsx("span",{children:s("common.yourself")}):e.jsxs(be,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(Ce,{className:"w-4 h-auto"})})}),e.jsxs(Se,{align:"end",sideOffset:2,children:[e.jsx(V,{onClick:()=>p(u),children:s("common.update")}),u.state===re.NORMAL?e.jsx(V,{onClick:()=>b(u),children:s("setting.member-section.archive-member")}):e.jsxs(e.Fragment,{children:[e.jsx(V,{onClick:()=>D(u),children:s("common.restore")}),e.jsx(V,{onClick:()=>A(u),className:"text-destructive focus:text-destructive",children:s("setting.member-section.delete-member")})]})]})]})})]},u.name))})]})})}),e.jsx(Me,{open:t.isOpen,onOpenChange:t.setOpen,onSuccess:n}),e.jsx(Me,{open:o.isOpen,onOpenChange:o.setOpen,user:c,onSuccess:n}),e.jsx(J,{open:!!l,onOpenChange:u=>!u&&g(void 0),title:l?s("setting.member-section.archive-warning",{username:l.username}):"",description:l?s("setting.member-section.archive-warning-description"):"",confirmLabel:s("common.confirm"),cancelLabel:s("common.cancel"),onConfirm:L,confirmVariant:"default"}),e.jsx(J,{open:!!m,onOpenChange:u=>!u&&d(void 0),title:m?s("setting.member-section.delete-warning",{username:m.username}):"",description:m?s("setting.member-section.delete-warning-description"):"",confirmLabel:s("common.delete"),cancelLabel:s("common.cancel"),onConfirm:j,confirmVariant:"destructive"})]})}),wt=gs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-destructive-foreground [a&]:hover:bg-destructive/90",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function De({className:s,variant:a,asChild:r=!1,...i}){const t=r?fs:"span";return e.jsx(t,{"data-slot":"badge",className:ye(wt({variant:a}),s),...i})}const yt=Q(()=>{const s=S(),[a,r]=f.useState(U.state.memoRelatedSetting),[i,t]=f.useState(a),[o,c]=f.useState(""),[h,x]=f.useState(""),l=n=>{const v=js.fromPartial({...i,...n});t(v)},g=()=>{o&&(l({reactions:Le([...i.reactions,o.trim()])}),c(""))},m=()=>{h&&(l({nsfwTags:Le([...i.nsfwTags,h.trim()])}),x(""))},d=async()=>{if(i.reactions.length===0){y.error("Reactions must not be empty.");return}try{await U.upsertWorkspaceSetting({name:`${me}${R.MEMO_RELATED}`,memoRelatedSetting:i}),r(i),y.success(s("message.update-succeed"))}catch(n){y.error(n.details),console.error(n)}};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.memo-related-settings.title")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-public-memos")}),e.jsx(P,{checked:i.disallowPublicVisibility,onCheckedChange:n=>l({disallowPublicVisibility:n})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.display-with-updated-time")}),e.jsx(P,{checked:i.displayWithUpdateTime,onCheckedChange:n=>l({displayWithUpdateTime:n})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-link-preview")}),e.jsx(P,{checked:i.enableLinkPreview,onCheckedChange:n=>l({enableLinkPreview:n})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.enable-double-click-to-edit")}),e.jsx(P,{checked:i.enableDoubleClickEdit,onCheckedChange:n=>l({enableDoubleClickEdit:n})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-markdown-shortcuts-in-editor")}),e.jsx(P,{checked:i.disableMarkdownShortcuts,onCheckedChange:n=>l({disableMarkdownShortcuts:n})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.content-lenght-limit")}),e.jsx(w,{className:"w-24",type:"number",defaultValue:i.contentLengthLimit,onBlur:n=>l({contentLengthLimit:Number(n.target.value)})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"truncate",children:s("setting.memo-related-settings.reactions")}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[i.reactions.map(n=>e.jsxs(De,{variant:"outline",className:"flex items-center gap-1 h-8",children:[n,e.jsx("span",{className:"cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>l({reactions:i.reactions.filter(v=>v!==n)}),children:e.jsx(ve,{className:"w-4 h-4"})})]},n)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-32",placeholder:s("common.input"),value:o,onChange:n=>c(n.target.value.trim())}),e.jsx("span",{className:"text-muted-foreground cursor-pointer hover:text-primary",onClick:()=>g(),children:e.jsx(Pe,{className:"w-5 h-5"})})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-blur-nsfw-content")}),e.jsx(P,{checked:i.enableBlurNsfwContent,onCheckedChange:n=>l({enableBlurNsfwContent:n})})]}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[i.nsfwTags.map(n=>e.jsxs(De,{variant:"outline",className:"flex items-center gap-1 h-8",children:[n,e.jsx("span",{className:"cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>l({nsfwTags:i.nsfwTags.filter(v=>v!==n)}),children:e.jsx(ve,{className:"w-4 h-4"})})]},n)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-32",placeholder:s("common.input"),value:h,onChange:n=>x(n.target.value.trim())}),e.jsx("span",{className:"text-muted-foreground cursor-pointer hover:text-primary",onClick:()=>m(),children:e.jsx(Pe,{className:"w-5 h-5"})})]})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(N,{disabled:F(i,a),onClick:d,children:s("common.save")})})]})});function Nt({open:s,onOpenChange:a,user:r,onSuccess:i}){const t=S(),[o,c]=f.useState(""),[h,x]=f.useState(""),l=()=>{a(!1)},g=n=>{const v=n.target.value;c(v)},m=n=>{const v=n.target.value;x(v)},d=async()=>{if(r){if(o===""||h===""){y.error(t("message.fill-all"));return}if(o!==h){y.error(t("message.new-password-not-match")),x("");return}try{await G.updateUser({name:r.name,password:o},["password"]),y(t("message.password-changed")),i?.(),a(!1)}catch(n){console.error(n),y.error(n.details)}}};return r?e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsxs(H,{children:[t("setting.account-section.change-password")," (",r.displayName,")"]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"newPassword",children:t("auth.new-password")}),e.jsx(w,{id:"newPassword",type:"password",placeholder:t("auth.new-password"),value:o,onChange:g})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"newPasswordAgain",children:t("auth.repeat-new-password")}),e.jsx(w,{id:"newPasswordAgain",type:"password",placeholder:t("auth.repeat-new-password"),value:h,onChange:m})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:l,children:t("common.cancel")}),e.jsx(N,{onClick:d,children:t("common.save")})]})]})}):null}function bt({open:s,onOpenChange:a,onSuccess:r}){const i=S(),t=O(),[o,c]=f.useState({avatarUrl:t.avatarUrl,username:t.username,displayName:t.displayName,email:t.email,description:t.description}),h=U.state.generalSetting,x=()=>{a(!1)},l=p=>{c(b=>({...b,...p}))},g=async p=>{const b=p.target.files;if(b&&b.length>0){const L=b[0];if(L.size>2*1024*1024){y.error("Max file size is 2MB");return}try{const D=await vs(L);l({avatarUrl:D})}catch(D){console.error(D),y.error("Failed to convert image to base64")}}},m=p=>{l({displayName:p.target.value})},d=p=>{l({username:p.target.value})},n=p=>{c(b=>({...b,email:p.target.value}))},v=p=>{c(b=>({...b,description:p.target.value}))},C=async()=>{if(o.username===""){y.error(i("message.fill-all"));return}try{const p=[];F(t.username,o.username)||p.push("username"),F(t.displayName,o.displayName)||p.push("display_name"),F(t.email,o.email)||p.push("email"),F(t.avatarUrl,o.avatarUrl)||p.push("avatar_url"),F(t.description,o.description)||p.push("description"),await G.updateUser(le.fromPartial({name:t.name,username:o.username,displayName:o.displayName,email:o.email,avatarUrl:o.avatarUrl,description:o.description}),p),y.success(i("message.update-succeed")),r?.(),a(!1)}catch(p){console.error(p),y.error(p.details)}};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:i("setting.account-section.update-information")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(k,{children:i("common.avatar")}),e.jsxs("label",{className:"relative cursor-pointer hover:opacity-80",children:[e.jsx(We,{className:"w-10 h-10",avatarUrl:o.avatarUrl}),e.jsx("input",{type:"file",accept:"image/*",className:"absolute invisible w-full h-full inset-0",onChange:g})]}),o.avatarUrl&&e.jsx(ve,{className:"w-4 h-auto cursor-pointer opacity-60 hover:opacity-80",onClick:()=>l({avatarUrl:""})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"username",children:[i("common.username"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.username-note"),")"]})]}),e.jsx(w,{id:"username",value:o.username,onChange:d,disabled:h.disallowChangeUsername})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"displayName",children:[i("common.nickname"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.nickname-note"),")"]})]}),e.jsx(w,{id:"displayName",value:o.displayName,onChange:m,disabled:h.disallowChangeNickname})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"email",children:[i("common.email"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.email-note"),")"]})]}),e.jsx(w,{id:"email",type:"email",value:o.email,onChange:n})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"description",children:i("common.description")}),e.jsx(ce,{id:"description",rows:2,value:o.description,onChange:v})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:x,children:i("common.cancel")}),e.jsx(N,{onClick:C,children:i("common.save")})]})]})})}function kt({open:s,onOpenChange:a,onSuccess:r}){const i=S(),t=O(),[o,c]=f.useState({description:"",expiration:3600*8}),h=Ne(!1),x=[{label:i("setting.access-token-section.create-dialog.duration-8h"),value:3600*8},{label:i("setting.access-token-section.create-dialog.duration-1m"),value:3600*24*30},{label:i("setting.access-token-section.create-dialog.duration-never"),value:0}],l=n=>{c({...o,...n})},g=n=>{l({description:n.target.value})},m=n=>{l({expiration:Number(n)})},d=async()=>{if(!o.description){y.error(i("message.description-is-required"));return}try{h.setLoading();const n=await I.createUserAccessToken({parent:t.name,accessToken:{description:o.description,expiresAt:o.expiration?new Date(Date.now()+o.expiration*1e3):void 0}});h.setFinish(),r(n),a(!1)}catch(n){y.error(n.details),console.error(n),h.setError()}};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:i("setting.access-token-section.create-dialog.create-access-token")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"description",children:[i("setting.access-token-section.create-dialog.description")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"description",type:"text",placeholder:i("setting.access-token-section.create-dialog.some-description"),value:o.description,onChange:g})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{children:[i("setting.access-token-section.create-dialog.expiration")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Ae,{value:o.expiration.toString(),onValueChange:m,className:"flex flex-row gap-4",children:x.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:n.value.toString(),id:`expiration-${n.value}`}),e.jsx(k,{htmlFor:`expiration-${n.value}`,children:n.label})]},n.value))})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:h.isLoading,onClick:()=>a(!1),children:i("common.cancel")}),e.jsx(N,{disabled:h.isLoading,onClick:d,children:i("common.create")})]})]})})}const _e=async s=>{const{accessTokens:a}=await I.listUserAccessTokens({parent:s});return a.sort((r,i)=>(i.issuedAt?.getTime()??0)-(r.issuedAt?.getTime()??0))},Ct=()=>{const s=S(),a=O(),[r,i]=f.useState([]),t=Z(),[o,c]=f.useState(void 0);f.useEffect(()=>{_e(a.name).then(n=>{i(n)})},[]);const h=async n=>{const v=await _e(a.name);i(v),y.success(s("setting.access-token-section.create-dialog.access-token-created",{description:n.description}))},x=()=>{t.open()},l=n=>{ws(n),y.success(s("setting.access-token-section.access-token-copied-to-clipboard"))},g=async n=>{c(n)},m=async()=>{if(!o)return;const{name:n,description:v}=o;await I.deleteUserAccessToken({name:n}),i(C=>C.filter(p=>p.name!==n)),c(void 0),y.success(s("setting.access-token-section.access-token-deleted",{description:v}))},d=n=>`${n.slice(0,4)}****${n.slice(-4)}`;return e.jsxs("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"sm:flex-auto space-y-1",children:[e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.access-token-section.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("setting.access-token-section.description")})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(N,{color:"primary",onClick:x,children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.token")}),e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-3 text-left text-sm font-semibold text-foreground",children:s("common.description")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.create-dialog.created-at")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.create-dialog.expires-at")}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:r.map(n=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground flex flex-row justify-start items-center gap-x-1",children:[e.jsx("span",{className:"font-mono",children:d(n.accessToken)}),e.jsx(N,{variant:"ghost",onClick:()=>l(n.accessToken),children:e.jsx(Ws,{className:"w-4 h-auto text-muted-foreground"})})]}),e.jsx("td",{className:"whitespace-nowrap py-2 pl-4 pr-3 text-sm text-foreground",children:n.description}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:n.issuedAt?.toLocaleString()}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:n.expiresAt?.toLocaleString()??s("setting.access-token-section.create-dialog.duration-never")}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:e.jsx(N,{variant:"ghost",onClick:()=>{g(n)},children:e.jsx(Ue,{className:"text-destructive w-4 h-auto"})})})]},n.accessToken))})]})})})})]}),e.jsx(kt,{open:t.isOpen,onOpenChange:t.setOpen,onSuccess:h}),e.jsx(J,{open:!!o,onOpenChange:n=>!n&&c(void 0),title:o?s("setting.access-token-section.access-token-deletion",{description:o.description}):"",description:s("setting.access-token-section.access-token-deletion-description"),confirmLabel:s("common.delete"),cancelLabel:s("common.cancel"),onConfirm:m,confirmVariant:"destructive"})]})},St=async s=>{const{sessions:a}=await I.listUserSessions({parent:s});return a.sort((r,i)=>(i.lastAccessedTime?.getTime()??0)-(r.lastAccessedTime?.getTime()??0))},Ut=()=>{const s=S(),a=O(),[r,i]=f.useState([]),[t,o]=f.useState(void 0);f.useEffect(()=>{St(a.name).then(d=>{i(d)})},[]);const c=async d=>{o(d)},h=async()=>{t&&(await I.revokeUserSession({name:t.name}),i(r.filter(d=>d.sessionId!==t.sessionId)),y.success(s("setting.user-sessions-section.session-revoked")),o(void 0))},x=d=>`${d.slice(0,8)}...${d.slice(-8)}`,l=d=>{switch(d?.toLowerCase()){case"mobile":return e.jsx(et,{className:"w-4 h-4 text-muted-foreground"});case"tablet":return e.jsx(tt,{className:"w-4 h-4 text-muted-foreground"});case"desktop":default:return e.jsx(Js,{className:"w-4 h-4 text-muted-foreground"})}},g=d=>{if(!d)return"Unknown Device";const n=[];return d.os&&n.push(d.os),d.browser&&n.push(d.browser),n.length>0?n.join(" • "):"Unknown Device"},m=d=>{if(r.length===0)return!1;const n=r[0];return d.sessionId===n.sessionId};return e.jsx("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"sm:flex sm:items-center sm:justify-between",children:e.jsxs("div",{className:"sm:flex-auto space-y-1",children:[e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.user-sessions-section.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("setting.user-sessions-section.description")})]})}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:[e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.user-sessions-section.device")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.user-sessions-section.last-active")}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:r.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[l(d.clientInfo?.deviceType||""),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[g(d.clientInfo),m(d)&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/20 text-primary",children:[e.jsx(ot,{className:"w-3 h-3 mr-1"}),s("setting.user-sessions-section.current")]})]}),e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:x(d.sessionId)})]})]})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($s,{className:"w-4 h-4"}),e.jsx("span",{children:d.lastAccessedTime?.toLocaleString()})]})}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:e.jsx(N,{variant:"ghost",disabled:m(d),onClick:()=>{c(d)},title:m(d)?s("setting.user-sessions-section.cannot-revoke-current"):s("setting.user-sessions-section.revoke-session"),children:e.jsx(Ue,{className:`w-4 h-auto ${m(d)?"text-muted-foreground":"text-destructive"}`})})})]},d.sessionId))})]}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("setting.user-sessions-section.no-sessions")})]})})}),e.jsx(J,{open:!!t,onOpenChange:d=>!d&&o(void 0),title:t?s("setting.user-sessions-section.session-revocation",{sessionId:x(t.sessionId)}):"",description:t?s("setting.user-sessions-section.session-revocation-description"):"",confirmLabel:s("setting.user-sessions-section.revoke-session-button"),cancelLabel:s("common.cancel"),onConfirm:h,confirmVariant:"destructive"})]})})},Tt=()=>{const s=S(),a=O(),r=Z(),i=Z(),t=()=>{r.open()},o=()=>{i.open()};return e.jsxs("div",{className:"w-full gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.account-section.title")}),e.jsxs("div",{className:"w-full mt-2 flex flex-row justify-start items-center",children:[e.jsx(We,{className:"mr-2 shrink-0 w-10 h-10",avatarUrl:a.avatarUrl}),e.jsxs("div",{className:"max-w-[calc(100%-3rem)] flex flex-col justify-center items-start",children:[e.jsxs("p",{className:"w-full",children:[e.jsx("span",{className:"text-xl leading-tight font-medium",children:a.displayName}),e.jsxs("span",{className:"ml-1 text-base leading-tight text-muted-foreground",children:["(",a.username,")"]})]}),e.jsx("p",{className:"w-4/5 leading-tight text-sm truncate",children:a.description})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-center mt-2 space-x-2",children:[e.jsxs(N,{variant:"outline",onClick:t,children:[e.jsx(ys,{className:"w-4 h-4 mx-auto mr-1"}),s("common.edit")]}),e.jsxs(be,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(Ce,{className:"w-4 h-4 mx-auto"})})}),e.jsx(Se,{align:"start",children:e.jsx(V,{onClick:o,children:s("setting.account-section.change-password")})})]})]}),e.jsx(Ut,{}),e.jsx(Ct,{}),e.jsx(bt,{open:r.isOpen,onOpenChange:r.setOpen}),e.jsx(Nt,{open:i.isOpen,onOpenChange:i.setOpen,user:a})]})};function It({open:s,onOpenChange:a,webhookName:r,onSuccess:i}){const t=S(),o=O(),[c,h]=f.useState({displayName:"",url:""}),x=Ne(!1),l=r===void 0;f.useEffect(()=>{r&&o&&I.listUserWebhooks({parent:o.name}).then(v=>{const C=v.webhooks.find(p=>p.name===r);C&&h({displayName:C.displayName,url:C.url})})},[r,o]);const g=v=>{h({...c,...v})},m=v=>{g({displayName:v.target.value})},d=v=>{g({url:v.target.value})},n=async()=>{if(!c.displayName||!c.url){y.error(t("message.fill-all-required-fields"));return}if(!o){y.error("User not authenticated");return}try{x.setLoading(),l?await I.createUserWebhook({parent:o.name,webhook:{displayName:c.displayName,url:c.url}}):await I.updateUserWebhook({webhook:{name:r,displayName:c.displayName,url:c.url},updateMask:["display_name","url"]}),i?.(),a(!1),x.setFinish()}catch(v){console.error(v),y.error(v.details),x.setError()}};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:t(l?"setting.webhook-section.create-dialog.create-webhook":"setting.webhook-section.create-dialog.edit-webhook")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"displayName",children:[t("setting.webhook-section.create-dialog.title")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"displayName",type:"text",placeholder:t("setting.webhook-section.create-dialog.an-easy-to-remember-name"),value:c.displayName,onChange:m})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"url",children:[t("setting.webhook-section.create-dialog.payload-url")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"url",type:"text",placeholder:t("setting.webhook-section.create-dialog.url-example-post-receive"),value:c.url,onChange:d})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:x.isLoading,onClick:()=>a(!1),children:t("common.cancel")}),e.jsx(N,{disabled:x.isLoading,onClick:n,children:t("common.create")})]})]})})}const At=()=>{const s=S(),a=O(),[r,i]=f.useState([]),[t,o]=f.useState(!1),[c,h]=f.useState(void 0),x=async()=>{if(!a)return[];const{webhooks:d}=await I.listUserWebhooks({parent:a.name});return d};f.useEffect(()=>{x().then(d=>{i(d)})},[a]);const l=async()=>{const d=await x(),n=d[d.length-1]?.displayName||"";i(d),o(!1),ee.success(s("setting.webhook-section.create-dialog.create-webhook-success",{name:n}))},g=async d=>{h(d)},m=async()=>{c&&(await I.deleteUserWebhook({name:c.name}),i(r.filter(d=>d.name!==c.name)),h(void 0),ee.success(s("setting.webhook-section.delete-dialog.delete-webhook-success",{name:c.displayName})))};return e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("div",{className:"flex-auto space-y-1",children:e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.webhook-section.title")})}),e.jsx("div",{children:e.jsx(N,{color:"primary",onClick:()=>o(!0),children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("common.name")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.webhook-section.url")}),e.jsx("th",{scope:"col",className:"relative px-3 py-2 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsxs("tbody",{className:"divide-y divide-border",children:[r.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",children:d.displayName}),e.jsx("td",{className:"max-w-[200px] px-3 py-2 text-sm text-foreground truncate",title:d.url,children:d.url}),e.jsx("td",{className:"relative whitespace-nowrap px-3 py-2 text-right text-sm",children:e.jsx(N,{variant:"ghost",onClick:()=>g(d),children:e.jsx(Ue,{className:"text-destructive w-4 h-auto"})})})]},d.name)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",colSpan:3,children:s("setting.webhook-section.no-webhooks-found")})})]})]})})})}),e.jsx("div",{className:"w-full mt-2",children:e.jsxs(Ns,{className:"text-muted-foreground text-sm inline-flex flex-row justify-start items-center hover:underline hover:text-primary",to:"https://www.usememos.com/docs/integrations/webhooks",target:"_blank",children:[s("common.learn-more"),e.jsx(qe,{className:"inline w-4 h-auto ml-1"})]})}),e.jsx(It,{open:t,onOpenChange:o,onSuccess:l}),e.jsx(J,{open:!!c,onOpenChange:d=>!d&&h(void 0),title:s("setting.webhook-section.delete-dialog.delete-webhook-title",{name:c?.displayName||""}),description:s("setting.webhook-section.delete-dialog.delete-webhook-description"),confirmLabel:s("common.delete"),cancelLabel:s("common.cancel"),onConfirm:m,confirmVariant:"destructive"})]})},Pt=Q(()=>{const s=S(),a=G.state.userGeneralSetting,r=async c=>{await G.updateUserGeneralSetting({locale:c},["locale"])},i=async c=>{await G.updateUserGeneralSetting({memoVisibility:c},["memoVisibility"])},t=async c=>{await G.updateUserGeneralSetting({theme:c},["theme"])},o=a||{locale:"en",memoVisibility:"PRIVATE",theme:"default"};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("common.language")}),e.jsx(He,{value:o.locale,onChange:r})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.preference-section.theme")}),e.jsx(Te,{value:o.theme,onValueChange:t})]}),e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.preference")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.preference-section.default-memo-visibility")}),e.jsxs(te,{value:o.memoVisibility,onValueChange:i,children:[e.jsx(ae,{className:"min-w-fit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{visibility:ks(o.memoVisibility)}),e.jsx(ne,{})]})}),e.jsx(ie,{children:[he.PRIVATE,he.PROTECTED,he.PUBLIC].map(c=>Cs(c)).map(c=>e.jsx(B,{value:c,className:"whitespace-nowrap",children:s(`memo.visibility.${c.toLowerCase()}`)},c))})]})]}),e.jsx(X,{className:"my-3"}),e.jsx(At,{})]})}),pe=[{name:"",title:"GitHub",type:_.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",scopes:["read:user"],fieldMapping:Y.fromPartial({identifier:"login",displayName:"name",email:"email"})}}},{name:"",title:"GitLab",type:_.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://gitlab.com/oauth/authorize",tokenUrl:"https://gitlab.com/oauth/token",userInfoUrl:"https://gitlab.com/oauth/userinfo",scopes:["openid"],fieldMapping:Y.fromPartial({identifier:"name",displayName:"name",email:"email"})}}},{name:"",title:"Google",type:_.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],fieldMapping:Y.fromPartial({identifier:"email",displayName:"name",email:"email"})}}},{name:"",title:"Custom",type:_.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}}}];function Rt({open:s,onOpenChange:a,identityProvider:r,onSuccess:i}){const t=S(),o=[...new Set(pe.map(j=>j.type))],[c,h]=f.useState({title:"",identifierFilter:""}),[x,l]=f.useState(_.OAUTH2),[g,m]=f.useState({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}),[d,n]=f.useState(""),[v,C]=f.useState("GitHub"),p=r===void 0;f.useEffect(()=>{s||(h({title:"",identifierFilter:""}),l(_.OAUTH2),m({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}),n(""),C("GitHub"))},[s]),f.useEffect(()=>{if(s&&r&&(h({title:r.title,identifierFilter:r.identifierFilter}),l(r.type),r.type===_.OAUTH2)){const j=Re.fromPartial(r.config?.oauth2Config||{});m(j),n(j.scopes.join(" "))}},[s,r]),f.useEffect(()=>{if(!p||!s)return;const j=pe.find(u=>u.title===v);if(j&&(h({title:j.title,identifierFilter:j.identifierFilter}),l(j.type),j.type===_.OAUTH2)){const u=Re.fromPartial(j.config?.oauth2Config||{});m(u),n(u.scopes.join(" "))}},[v,p,s]);const b=()=>{a(!1)},L=()=>!(c.title===""||x==="OAUTH2"&&(g.clientId===""||g.authUrl===""||g.tokenUrl===""||g.userInfoUrl===""||d===""||g.fieldMapping?.identifier===""||p&&g.clientSecret==="")),D=async()=>{try{p?(await oe.createIdentityProvider({identityProvider:{...c,type:x,config:{oauth2Config:{...g,scopes:d.split(" ")}}}}),y.success(t("setting.sso-section.sso-created",{name:c.title}))):(await oe.updateIdentityProvider({identityProvider:{...c,name:r.name,type:x,config:{oauth2Config:{...g,scopes:d.split(" ")}}},updateMask:["title","identifier_filter","config"]}),y.success(t("setting.sso-section.sso-updated",{name:c.title})))}catch(j){y.error(j.details),console.error(j)}i?.(),a(!1)},A=j=>{m({...g,...j})};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(H,{children:t(p?"setting.sso-section.create-sso":"setting.sso-section.update-sso")})}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full space-y-4",children:[p&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-1!",children:t("common.type")}),e.jsxs(te,{value:String(x),onValueChange:j=>l(parseInt(j)),children:[e.jsx(ae,{className:"w-full mb-4",children:e.jsx(ne,{})}),e.jsx(ie,{children:o.map(j=>e.jsx(B,{value:String(j),children:_[j]||j},j))})]}),e.jsx("p",{className:"mb-2 text-sm font-medium",children:t("setting.sso-section.template")}),e.jsxs(te,{value:v,onValueChange:j=>C(j),children:[e.jsx(ae,{className:"mb-1 h-auto w-full",children:e.jsx(ne,{})}),e.jsx(ie,{children:pe.map(j=>e.jsx(B,{value:j.title,children:j.title},j.title))})]}),e.jsx(X,{className:"my-2"})]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("common.name"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("common.name"),value:c.title,onChange:j=>h({...c,title:j.target.value})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("setting.sso-section.identifier-filter")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.identifier-filter"),value:c.identifierFilter,onChange:j=>h({...c,identifierFilter:j.target.value})}),e.jsx(X,{className:"my-2"}),x==="OAUTH2"&&e.jsxs(e.Fragment,{children:[p&&e.jsxs("p",{className:"border border-border rounded-md p-2 text-sm w-full mb-2 break-all",children:[t("setting.sso-section.redirect-url"),": ",Ss("/auth/callback")]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.client-id"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.client-id"),value:g.clientId,onChange:j=>A({clientId:j.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.client-secret"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.client-secret"),value:g.clientSecret,onChange:j=>A({clientSecret:j.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.authorization-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.authorization-endpoint"),value:g.authUrl,onChange:j=>A({authUrl:j.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.token-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.token-endpoint"),value:g.tokenUrl,onChange:j=>A({tokenUrl:j.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.user-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.user-endpoint"),value:g.userInfoUrl,onChange:j=>A({userInfoUrl:j.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.scopes"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.scopes"),value:d,onChange:j=>n(j.target.value)}),e.jsx(X,{className:"my-2"}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.identifier"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.identifier"),value:g.fieldMapping.identifier,onChange:j=>A({fieldMapping:{...g.fieldMapping,identifier:j.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("setting.sso-section.display-name")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.display-name"),value:g.fieldMapping.displayName,onChange:j=>A({fieldMapping:{...g.fieldMapping,displayName:j.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("common.email")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("common.email"),value:g.fieldMapping.email,onChange:j=>A({fieldMapping:{...g.fieldMapping,email:j.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:"Avatar URL"}),e.jsx(w,{className:"mb-2 w-full",placeholder:"Avatar URL",value:g.fieldMapping.avatarUrl,onChange:j=>A({fieldMapping:{...g.fieldMapping,avatarUrl:j.target.value}})})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:b,children:t("common.cancel")}),e.jsx(N,{onClick:D,disabled:!L(),children:t(p?"common.create":"common.update")})]})]})})}const Et=s=>{const{className:a,url:r,title:i}=s,t=S();return e.jsx(Be,{children:e.jsxs($e,{children:[e.jsx(ze,{asChild:!0,children:e.jsx("a",{className:`text-muted-foreground hover:text-primary ${a}`,href:r,target:"_blank",children:e.jsx(qe,{className:"w-4 h-auto"})})}),e.jsx(Ke,{children:e.jsx("p",{children:i??t("common.learn-more")})})]})})},Lt=()=>{const s=S(),[a,r]=f.useState([]),[i,t]=f.useState(!1),[o,c]=f.useState(),[h,x]=f.useState(void 0);f.useEffect(()=>{l()},[]);const l=async()=>{const{identityProviders:p}=await oe.listIdentityProviders({});r(p)},g=async p=>{x(p)},m=async()=>{if(h){try{await oe.deleteIdentityProvider({name:h.name})}catch(p){console.error(p),y.error(p.details)}await l(),x(void 0)}},d=()=>{c(void 0),t(!0)},n=p=>{c(p),t(!0)},v=async()=>{await l(),t(!1),c(void 0)},C=p=>{t(p),p||c(void 0)};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[e.jsx("span",{className:"font-mono text-muted-foreground",children:s("setting.sso-section.sso-list")}),e.jsx(Et,{url:"https://www.usememos.com/docs/configuration/authentication"})]}),e.jsx(N,{color:"primary",onClick:d,children:s("common.create")})]}),e.jsx(X,{}),a.map(p=>e.jsxs("div",{className:"py-2 w-full border-b last:border-b border-border flex flex-row items-center justify-between",children:[e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs("p",{className:"ml-2",children:[p.title,e.jsxs("span",{className:"text-sm ml-1 text-muted-foreground",children:["(",p.type,")"]})]})}),e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs(be,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(Ce,{className:"w-4 h-auto"})})}),e.jsxs(Se,{align:"end",sideOffset:2,children:[e.jsx(V,{onClick:()=>n(p),children:s("common.edit")}),e.jsx(V,{onClick:()=>g(p),children:s("common.delete")})]})]})})]},p.name)),a.length===0&&e.jsx("div",{className:"w-full mt-2 text-sm border-border text-muted-foreground flex flex-row items-center justify-between",children:e.jsx("p",{className:"",children:s("setting.sso-section.no-sso-found")})}),e.jsx(Rt,{open:i,onOpenChange:C,identityProvider:o,onSuccess:v}),e.jsx(J,{open:!!h,onOpenChange:p=>!p&&x(void 0),title:h?s("setting.sso-section.confirm-delete",{name:h.title}):"",confirmLabel:s("common.delete"),cancelLabel:s("common.cancel"),onConfirm:m,confirmVariant:"destructive"})]})},Oe=({text:s,icon:a,isSelected:r,onClick:i})=>e.jsxs("div",{onClick:i,className:`w-auto max-w-full px-3 leading-8 flex flex-row justify-start items-center cursor-pointer rounded-lg select-none hover:opacity-80 ${r?"bg-accent shadow":""}`,children:[e.jsx(a,{className:"w-4 h-auto mr-2 opacity-80 shrink-0"}),e.jsx("span",{className:"truncate",children:s})]}),Mt=Q(()=>{const s=S(),[a,r]=f.useState(xe.fromPartial(U.getWorkspaceSettingByKey(R.STORAGE)?.storageSetting||{}));f.useEffect(()=>{r(xe.fromPartial(U.getWorkspaceSettingByKey(R.STORAGE)?.storageSetting||{}))},[U.getWorkspaceSettingByKey(R.STORAGE)]);const i=f.useMemo(()=>{if(a.uploadSizeLimitMb<=0)return!1;const u=xe.fromPartial(U.getWorkspaceSettingByKey(R.STORAGE)?.storageSetting||{});if(a.storageType===M.LOCAL){if(a.filepathTemplate.length===0)return!1}else if(a.storageType===M.S3){if(a.s3Config?.accessKeyId.length===0||a.s3Config?.accessKeySecret.length===0||a.s3Config?.endpoint.length===0||a.s3Config?.region.length===0||a.s3Config?.bucket.length===0)return!1}else if(a.storageType===M.ALIYUN_OSS&&(!a.ossConfig?.accessKeyId||!a.ossConfig?.accessKeySecret||!a.ossConfig?.endpoint||!a.ossConfig?.region||!a.ossConfig?.bucket))return!1;return!F(u,a)},[a,U.state]),t=async u=>{let T=parseInt(u.target.value);Number.isNaN(T)&&(T=0);const rs={...a,uploadSizeLimitMb:T};r(rs)},o=async u=>{const T={...a,filepathTemplate:u.target.value};r(T)},c=async u=>{const T={...a,s3Config:Us.fromPartial({...a.s3Config,...u})};r(T)},h=async u=>{c({accessKeyId:u.target.value})},x=async u=>{c({accessKeySecret:u.target.value})},l=async u=>{c({endpoint:u.target.value})},g=async u=>{c({region:u.target.value})},m=async u=>{c({bucket:u.target.value})},d=u=>{c({usePathStyle:u.target.checked})},n=async u=>{const T={...a,ossConfig:{...a.ossConfig,...u}};r(T)},v=async u=>{n({endpoint:u.target.value})},C=async u=>{n({region:u.target.value})},p=async u=>{n({accessKeyId:u.target.value})},b=async u=>{n({accessKeySecret:u.target.value})},L=async u=>{n({bucket:u.target.value})},D=u=>{n({useSsl:u})},A=async u=>{const T={...a,storageType:u};r(T)},j=async()=>{await U.upsertWorkspaceSetting({name:`${me}${R.STORAGE}`,storageSetting:a}),y.success("Updated")};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:s("setting.storage-section.current-storage")}),e.jsxs(Ae,{value:a.storageType,onValueChange:u=>{A(u)},className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:M.DATABASE,id:"database"}),e.jsx(k,{htmlFor:"database",children:s("setting.storage-section.type-database")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:M.LOCAL,id:"local"}),e.jsx(k,{htmlFor:"local",children:s("setting.storage-section.type-local")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:M.S3,id:"s3"}),e.jsx(k,{htmlFor:"s3",children:"S3"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{value:M.ALIYUN_OSS,id:"aliyun_oss"}),e.jsx(k,{htmlFor:"aliyun_oss",children:s("setting.storage-section.type-aliyun-oss")})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.system-section.max-upload-size")}),e.jsx(Be,{children:e.jsxs($e,{children:[e.jsx(ze,{children:e.jsx(Os,{className:"w-4 h-auto"})}),e.jsx(Ke,{children:e.jsx("p",{children:s("setting.system-section.max-upload-size-hint")})})]})})]}),e.jsx(w,{className:"w-16 font-mono",value:a.uploadSizeLimitMb,onChange:t})]}),a.storageType!==M.DATABASE&&e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.filepath-template")}),e.jsx(w,{className:"w-64",value:a.filepathTemplate,placeholder:"assets/{timestamp}_{filename}",onChange:o})]}),a.storageType===M.S3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Access key id"}),e.jsx(w,{className:"w-64",value:a.s3Config?.accessKeyId,placeholder:"",onChange:h})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Access key secret"}),e.jsx(w,{className:"w-64",value:a.s3Config?.accessKeySecret,placeholder:"",onChange:x})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Endpoint"}),e.jsx(w,{className:"w-64",value:a.s3Config?.endpoint,placeholder:"",onChange:l})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Region"}),e.jsx(w,{className:"w-64",value:a.s3Config?.region,placeholder:"",onChange:g})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Bucket"}),e.jsx(w,{className:"w-64",value:a.s3Config?.bucket,placeholder:"",onChange:m})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Use Path Style"}),e.jsx(P,{checked:a.s3Config?.usePathStyle,onCheckedChange:u=>d({target:{checked:u}})})]})]}),a.storageType===M.ALIYUN_OSS&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-endpoint")}),e.jsx(w,{className:"w-64",value:a.ossConfig?.endpoint||"",placeholder:"oss-cn-hangzhou.aliyuncs.com",onChange:v})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-region")}),e.jsx(w,{className:"w-64",value:a.ossConfig?.region||"",placeholder:"cn-hangzhou",onChange:C})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-access-key-id")}),e.jsx(w,{className:"w-64",value:a.ossConfig?.accessKeyId||"",placeholder:"LTAI5t...",onChange:p})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-access-key-secret")}),e.jsx(w,{className:"w-64",type:"password",value:a.ossConfig?.accessKeySecret||"",placeholder:"••••••••",onChange:b})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-bucket")}),e.jsx(w,{className:"w-64",value:a.ossConfig?.bucket||"",placeholder:"memos-attachments",onChange:L})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-use-ssl")}),e.jsx(P,{checked:a.ossConfig?.useSsl!==!1,onCheckedChange:D})]})]}),e.jsx("div",{children:e.jsx(N,{disabled:!i,onClick:j,children:s("common.save")})})]})});function Dt({open:s,onOpenChange:a,onSuccess:r}){const i=S(),t=U.state.generalSetting,[o,c]=f.useState(Ts.fromPartial(t.customProfile||{})),[h,x]=f.useState(!1),l=b=>{c(L=>({...L,...b}))},g=b=>{l({title:b.target.value})},m=b=>{l({logoUrl:b.target.value})},d=b=>{l({description:b.target.value})},n=b=>{l({locale:b})},v=()=>{l({title:"Memos",logoUrl:"/logo.webp",description:"",locale:"en"})},C=()=>{a(!1)},p=async()=>{if(o.title===""){y.error("Title cannot be empty.");return}x(!0);try{await U.upsertWorkspaceSetting({name:`${me}${R.GENERAL}`,generalSetting:{...t,customProfile:o}}),y.success(i("message.update-succeed")),r?.(),a(!1)}catch(b){console.error(b),y.error("Failed to update profile")}finally{x(!1)}};return e.jsx($,{open:s,onOpenChange:a,children:e.jsxs(z,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(H,{children:i("setting.system-section.customize-server.title")}),e.jsx(Is,{children:"Customize your workspace appearance and settings."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"server-name",children:i("setting.system-section.server-name")}),e.jsx(w,{id:"server-name",type:"text",value:o.title,onChange:g,placeholder:"Enter server name"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"icon-url",children:i("setting.system-section.customize-server.icon-url")}),e.jsx(w,{id:"icon-url",type:"text",value:o.logoUrl,onChange:m,placeholder:"Enter icon URL"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"description",children:i("setting.system-section.customize-server.description")}),e.jsx(ce,{id:"description",rows:3,value:o.description,onChange:d,placeholder:"Enter description"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:i("setting.system-section.customize-server.locale")}),e.jsx(He,{value:o.locale,onChange:n})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Theme"}),e.jsx(Te,{})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row sm:justify-between gap-2",children:[e.jsx(N,{variant:"outline",onClick:v,disabled:h,className:"sm:mr-auto",children:i("common.restore")}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(N,{variant:"ghost",onClick:C,disabled:h,className:"flex-1 sm:flex-initial",children:i("common.cancel")}),e.jsx(N,{onClick:p,disabled:h,className:"flex-1 sm:flex-initial",children:h?"Saving...":i("common.save")})]})]})]})})}const _t=Q(()=>{const s=S(),a=Z(),r=Ee.fromPartial(U.getWorkspaceSettingByKey(R.GENERAL)?.generalSetting||{}),[i,t]=f.useState(r),[o,c]=f.useState([]);f.useEffect(()=>{t({...i,customProfile:r.customProfile})},[U.getWorkspaceSettingByKey(R.GENERAL)]);const h=()=>{a.open()},x=m=>{t(Ee.fromPartial({...i,...m}))},l=async()=>{try{await U.upsertWorkspaceSetting({name:`${me}${R.GENERAL}`,generalSetting:i})}catch(m){y.error(m.details),console.error(m);return}y.success(s("message.update-succeed"))};f.useEffect(()=>{g()},[]);const g=async()=>{const{identityProviders:m}=await oe.listIdentityProviders({});c(m)};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-foreground",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{children:[s("setting.system-section.server-name"),":"," ",e.jsx("span",{className:"font-mono font-bold",children:i.customProfile?.title||"Memos"})]}),e.jsx(N,{variant:"outline",onClick:h,children:s("common.edit")})]}),e.jsx(X,{}),e.jsx("p",{className:"font-medium text-foreground",children:s("setting.system-section.title")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:"Theme"}),e.jsx(Te,{value:i.theme||"default",onValueChange:m=>x({theme:m}),className:"min-w-fit"})]}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-style")})}),e.jsx(ce,{className:"font-mono w-full",rows:3,placeholder:s("setting.system-section.additional-style-placeholder"),value:i.additionalStyle,onChange:m=>x({additionalStyle:m.target.value})}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-script")})}),e.jsx(ce,{className:"font-mono w-full",rows:3,placeholder:s("setting.system-section.additional-script-placeholder"),value:i.additionalScript,onChange:m=>x({additionalScript:m.target.value})}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-user-registration")}),e.jsx(P,{disabled:U.state.profile.mode==="demo",checked:i.disallowUserRegistration,onCheckedChange:m=>x({disallowUserRegistration:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-password-auth")}),e.jsx(P,{disabled:U.state.profile.mode==="demo"||o.length===0&&!i.disallowPasswordAuth,checked:i.disallowPasswordAuth,onCheckedChange:m=>x({disallowPasswordAuth:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-username")}),e.jsx(P,{checked:i.disallowChangeUsername,onCheckedChange:m=>x({disallowChangeUsername:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-nickname")}),e.jsx(P,{checked:i.disallowChangeNickname,onCheckedChange:m=>x({disallowChangeNickname:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.workspace-section.week-start-day")}),e.jsxs(te,{value:i.weekStartDayOffset.toString(),onValueChange:m=>{x({weekStartDayOffset:parseInt(m)||0})},children:[e.jsx(ae,{className:"min-w-fit",children:e.jsx(ne,{})}),e.jsxs(ie,{children:[e.jsx(B,{value:"-1",children:s("setting.workspace-section.saturday")}),e.jsx(B,{value:"0",children:s("setting.workspace-section.sunday")}),e.jsx(B,{value:"1",children:s("setting.workspace-section.monday")})]})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(N,{disabled:F(i,r),onClick:l,children:s("common.save")})}),e.jsx(Dt,{open:a.isOpen,onOpenChange:a.setOpen,onSuccess:()=>{y.success("Profile updated successfully!")}})]})}),fe=["my-account","preference"],ge=["member","system","memo-related","storage","sso"],Fe={"my-account":nt,preference:Ks,member:Ms,system:Ls,"memo-related":Es,storage:qs,sso:Xs},zt=Q(()=>{const s=S(),{md:a}=As(),r=Ps(),i=O(),[t,o]=f.useState({selectedSection:"my-account"}),c=i.role===se.HOST,h=f.useMemo(()=>{let l=[...fe];return c&&(l=l.concat(ge)),l},[c]);f.useEffect(()=>{let l=r.hash.slice(1);[...fe,...ge].includes(l)||(l="my-account"),o({selectedSection:l})},[r.hash]),f.useEffect(()=>{c&&(async()=>[R.MEMO_RELATED,R.STORAGE].forEach(async l=>{await U.fetchWorkspaceSetting(l)}))()},[c]);const x=f.useCallback(l=>{window.location.hash=l},[]);return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-start sm:pt-3 md:pt-6 pb-8",children:[!a&&e.jsx(Rs,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-row justify-start items-start px-4 py-3 rounded-xl bg-background text-muted-foreground",children:[e.jsxs("div",{className:"hidden sm:flex flex-col justify-start items-start w-40 h-auto shrink-0 py-2",children:[e.jsx("span",{className:"text-sm mt-0.5 pl-3 font-mono select-none text-muted-foreground",children:s("common.basic")}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:fe.map(l=>e.jsx(Oe,{text:s(`setting.${l}`),icon:Fe[l],isSelected:t.selectedSection===l,onClick:()=>x(l)},l))}),c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm mt-4 pl-3 font-mono select-none text-muted-foreground",children:s("common.admin")}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:[ge.map(l=>e.jsx(Oe,{text:s(`setting.${l}`),icon:Fe[l],isSelected:t.selectedSection===l,onClick:()=>x(l)},l)),e.jsxs("span",{className:"px-3 mt-2 opacity-70 text-sm",children:[s("setting.version"),": v",U.state.profile.version]})]})]}):null]}),e.jsxs("div",{className:"w-full grow sm:pl-4 overflow-x-auto",children:[e.jsx("div",{className:"w-auto inline-block my-2 sm:hidden",children:e.jsxs(te,{value:t.selectedSection,onValueChange:l=>x(l),children:[e.jsx(ae,{className:"w-[180px]",children:e.jsx(ne,{placeholder:"Select section"})}),e.jsx(ie,{children:h.map(l=>e.jsx(B,{value:l,children:s(`setting.${l}`)},l))})]})}),t.selectedSection==="my-account"?e.jsx(Tt,{}):t.selectedSection==="preference"?e.jsx(Pt,{}):t.selectedSection==="member"?e.jsx(vt,{}):t.selectedSection==="system"?e.jsx(_t,{}):t.selectedSection==="memo-related"?e.jsx(yt,{}):t.selectedSection==="storage"?e.jsx(Mt,{}):t.selectedSection==="sso"?e.jsx(Lt,{}):null]})]})})]})});export{zt as default};
