import{p as T,aa as Oe,ab as rs,ac as ls,j as e,ad as Fe,ae as os,af as oe,ag as je,ah as cs,ai as fe,aj as ds,ak as ms,al as us,c as we,u as S,U as re,b as ve,am as $,an as z,ao as K,ap as H,aq as k,I as w,N as Q,ar as q,B as N,n as y,O as I,o as J,e as D,as as Z,V as F,at as hs,S as ie,au as ye,av as Ne,aw as be,ax as ke,ay as W,az as xs,aA as ps,w as U,aB as A,aC as ge,aD as Ae,aE as fs,aF as ce,aG as P,W as Ge,aH as le,aI as gs,D as Ce,X as js,aJ as ws,G as vs,a4 as ee,a5 as se,aK as ys,aL as Ns,a6 as te,a7 as ae,aM as me,aN as bs,a9 as V,y as X,aO as Y,K as L,aP as Pe,h as ks,H as ne,T as We,z as Be,C as Ve,F as $e,aQ as ue,aR as M,aS as Cs,aT as Ss,aU as Us,aV as Te,k as Is,aW as As,l as Ps,aX as Ts,aY as Rs,aZ as Es}from"./index.js";import{r as p}from"./leaflet-vendor.js";import{s as Ms,J as O,K as Re}from"./utils-vendor.js";import{L as ze,T as Se}from"./ThemeSelect.js";import{E as Ke}from"./external-link.js";import"./mermaid-vendor.js";import"./katex-vendor.js";/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ds=T("circle-help",Ls);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Os=T("circle",_s);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],Gs=T("clipboard",Fs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Bs=T("clock",Ws);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],$s=T("cog",Vs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ks=T("database",zs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],qs=T("key",Hs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Xs=T("monitor",Ys);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Js=T("smartphone",Zs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]],et=T("tablet",Qs);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],tt=T("user",st);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],nt=T("wifi",at);var Ue="Radio",[it,He]=Fe(Ue),[rt,lt]=it(Ue),qe=p.forwardRef((s,n)=>{const{__scopeRadio:o,name:i,checked:t=!1,required:r,disabled:c,value:x="on",onCheck:h,form:a,...d}=s,[m,v]=p.useState(null),l=je(n,u=>v(u)),g=p.useRef(!1),C=m?a||!!m.closest("form"):!0;return e.jsxs(rt,{scope:o,checked:t,disabled:c,children:[e.jsx(oe.button,{type:"button",role:"radio","aria-checked":t,"data-state":Je(t),"data-disabled":c?"":void 0,disabled:c,value:x,...d,ref:l,onClick:fe(s.onClick,u=>{t||h?.(),C&&(g.current=u.isPropagationStopped(),g.current||u.stopPropagation())})}),C&&e.jsx(Ze,{control:m,bubbles:!g.current,name:i,value:x,checked:t,required:r,disabled:c,form:a,style:{transform:"translateX(-100%)"}})]})});qe.displayName=Ue;var Ye="RadioIndicator",Xe=p.forwardRef((s,n)=>{const{__scopeRadio:o,forceMount:i,...t}=s,r=lt(Ye,o);return e.jsx(ds,{present:i||r.checked,children:e.jsx(oe.span,{"data-state":Je(r.checked),"data-disabled":r.disabled?"":void 0,...t,ref:n})})});Xe.displayName=Ye;var ot="RadioBubbleInput",Ze=p.forwardRef(({__scopeRadio:s,control:n,checked:o,bubbles:i=!0,...t},r)=>{const c=p.useRef(null),x=je(c,r),h=ms(o),a=us(n);return p.useEffect(()=>{const d=c.current;if(!d)return;const m=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(m,"checked").set;if(h!==o&&l){const g=new Event("click",{bubbles:i});l.call(d,o),d.dispatchEvent(g)}},[h,o,i]),e.jsx(oe.input,{type:"radio","aria-hidden":!0,defaultChecked:o,...t,tabIndex:-1,ref:x,style:{...t.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ze.displayName=ot;function Je(s){return s?"checked":"unchecked"}var ct=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],de="RadioGroup",[dt]=Fe(de,[Oe,He]),Qe=Oe(),es=He(),[mt,ut]=dt(de),ss=p.forwardRef((s,n)=>{const{__scopeRadioGroup:o,name:i,defaultValue:t,value:r,required:c=!1,disabled:x=!1,orientation:h,dir:a,loop:d=!0,onValueChange:m,...v}=s,l=Qe(o),g=rs(a),[C,u]=ls({prop:r,defaultProp:t??null,onChange:m,caller:de});return e.jsx(mt,{scope:o,name:i,required:c,disabled:x,value:C,onValueChange:u,children:e.jsx(os,{asChild:!0,...l,orientation:h,dir:g,loop:d,children:e.jsx(oe.div,{role:"radiogroup","aria-required":c,"aria-orientation":h,"data-disabled":x?"":void 0,dir:g,...v,ref:n})})})});ss.displayName=de;var ts="RadioGroupItem",as=p.forwardRef((s,n)=>{const{__scopeRadioGroup:o,disabled:i,...t}=s,r=ut(ts,o),c=r.disabled||i,x=Qe(o),h=es(o),a=p.useRef(null),d=je(n,a),m=r.value===t.value,v=p.useRef(!1);return p.useEffect(()=>{const l=C=>{ct.includes(C.key)&&(v.current=!0)},g=()=>v.current=!1;return document.addEventListener("keydown",l),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",l),document.removeEventListener("keyup",g)}},[]),e.jsx(cs,{asChild:!0,...x,focusable:!c,active:m,children:e.jsx(qe,{disabled:c,required:r.required,checked:m,...h,...t,name:r.name,ref:d,onCheck:()=>r.onValueChange(t.value),onKeyDown:fe(l=>{l.key==="Enter"&&l.preventDefault()}),onFocus:fe(t.onFocus,()=>{v.current&&a.current?.click()})})})});as.displayName=ts;var ht="RadioGroupIndicator",ns=p.forwardRef((s,n)=>{const{__scopeRadioGroup:o,...i}=s,t=es(o);return e.jsx(Xe,{...t,...i,ref:n})});ns.displayName=ht;var xt=ss,pt=as,ft=ns;function Ie({className:s,...n}){return e.jsx(xt,{"data-slot":"radio-group",className:we("grid gap-3",s),...n})}function B({className:s,...n}){return e.jsx(pt,{"data-slot":"radio-group-item",className:we("border-border text-primary aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] disabled:cursor-not-allowed disabled:opacity-50",s),...n,children:e.jsx(ft,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Os,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Ee({open:s,onOpenChange:n,user:o,onSuccess:i}){const t=S(),[r,c]=p.useState(re.fromPartial({...o})),x=ve(!1),h=!o;p.useEffect(()=>{c(o?re.fromPartial(o):re.fromPartial({}))},[o]);const a=m=>{c({...r,...m})},d=async()=>{if(h&&(!r.username||!r.password)){y.error("Username and password cannot be empty");return}try{if(x.setLoading(),h)await I.createUser({user:r}),y.success("Create user successfully");else{const m=[];r.username!==o?.username&&m.push("username"),r.password&&m.push("password"),r.role!==o?.role&&m.push("role"),await I.updateUser({user:r,updateMask:m}),y.success("Update user successfully")}x.setFinish(),i?.(),n(!1)}catch(m){console.error(m),y.error(m.details),x.setError()}};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:`${t(h?"common.create":"common.edit")} ${t("common.user")}`})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"username",children:t("common.username")}),e.jsx(w,{id:"username",type:"text",placeholder:t("common.username"),value:r.username,onChange:m=>a({username:m.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"password",children:t("common.password")}),e.jsx(w,{id:"password",type:"password",placeholder:t("common.password"),autoComplete:"off",value:r.password,onChange:m=>a({password:m.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:t("common.role")}),e.jsxs(Ie,{value:r.role,onValueChange:m=>a({role:m}),className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:Q.USER,id:"user"}),e.jsx(k,{htmlFor:"user",children:t("setting.member-section.user")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:Q.ADMIN,id:"admin"}),e.jsx(k,{htmlFor:"admin",children:t("setting.member-section.admin")})]})]})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:x.isLoading,onClick:()=>n(!1),children:t("common.cancel")}),e.jsx(N,{disabled:x.isLoading,onClick:d,children:t("common.confirm")})]})]})})}const gt=J(()=>{const s=S(),n=D(),[o,i]=p.useState([]),t=Z(),r=Z(),[c,x]=p.useState(),h=Ms(o,"id");p.useEffect(()=>{a()},[]);const a=async()=>{const u=await F.fetchUsers();i(u)},d=u=>u===Q.HOST?"Host":u===Q.ADMIN?s("setting.member-section.admin"):s("setting.member-section.user"),m=()=>{x(void 0),t.open()},v=u=>{x(u),r.open()},l=async u=>{window.confirm(s("setting.member-section.archive-warning",{username:u.displayName}))&&(await I.updateUser({user:{name:u.name,state:ie.ARCHIVED},updateMask:["state"]}),a())},g=async u=>{await I.updateUser({user:{name:u.name,state:ie.NORMAL},updateMask:["state"]}),a()},C=async u=>{window.confirm(s("setting.member-section.delete-warning",{username:u.displayName}))&&(await F.deleteUser(u.name),a())};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.member-section.create-a-member")}),e.jsxs(N,{onClick:m,children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),s("common.create")]})]}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center mt-6",children:e.jsx("div",{className:"title-text",children:s("setting.member-list")})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full align-middle border border-border rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm font-semibold text-left text-foreground",children:[e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.username")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.role")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.nickname")}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:s("common.email")}),e.jsx("th",{scope:"col",className:"relative py-2 pl-3 pr-4"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:h.map(u=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:[u.username,e.jsx("span",{className:"ml-1 italic",children:u.state===ie.ARCHIVED&&"(Archived)"})]}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:d(u.role)}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:u.displayName}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:u.email}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm font-medium flex justify-end",children:n?.name===u.name?e.jsx("span",{children:s("common.yourself")}):e.jsxs(ye,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(be,{className:"w-4 h-auto"})})}),e.jsxs(ke,{align:"end",sideOffset:2,children:[e.jsx(W,{onClick:()=>v(u),children:s("common.update")}),u.state===ie.NORMAL?e.jsx(W,{onClick:()=>l(u),children:s("setting.member-section.archive-member")}):e.jsxs(e.Fragment,{children:[e.jsx(W,{onClick:()=>g(u),children:s("common.restore")}),e.jsx(W,{onClick:()=>C(u),className:"text-destructive focus:text-destructive",children:s("setting.member-section.delete-member")})]})]})]})})]},u.name))})]})})}),e.jsx(Ee,{open:t.isOpen,onOpenChange:t.setOpen,onSuccess:a}),e.jsx(Ee,{open:r.isOpen,onOpenChange:r.setOpen,user:c,onSuccess:a})]})}),jt=ps("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-destructive-foreground [a&]:hover:bg-destructive/90",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Me({className:s,variant:n,asChild:o=!1,...i}){const t=o?xs:"span";return e.jsx(t,{"data-slot":"badge",className:we(jt({variant:n}),s),...i})}const wt=J(()=>{const s=S(),[n,o]=p.useState(U.state.memoRelatedSetting),[i,t]=p.useState(n),[r,c]=p.useState(""),[x,h]=p.useState(""),a=l=>{const g=fs.fromPartial({...i,...l});t(g)},d=()=>{r&&(a({reactions:Re([...i.reactions,r.trim()])}),c(""))},m=()=>{x&&(a({nsfwTags:Re([...i.nsfwTags,x.trim()])}),h(""))},v=async()=>{if(i.reactions.length===0){y.error("Reactions must not be empty.");return}try{await U.upsertWorkspaceSetting({name:`${ce}${P.MEMO_RELATED}`,memoRelatedSetting:i}),o(i),y.success(s("message.update-succeed"))}catch(l){y.error(l.details),console.error(l)}};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.memo-related-settings.title")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-public-memos")}),e.jsx(A,{checked:i.disallowPublicVisibility,onCheckedChange:l=>a({disallowPublicVisibility:l})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.display-with-updated-time")}),e.jsx(A,{checked:i.displayWithUpdateTime,onCheckedChange:l=>a({displayWithUpdateTime:l})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-link-preview")}),e.jsx(A,{checked:i.enableLinkPreview,onCheckedChange:l=>a({enableLinkPreview:l})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.enable-double-click-to-edit")}),e.jsx(A,{checked:i.enableDoubleClickEdit,onCheckedChange:l=>a({enableDoubleClickEdit:l})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.system-section.disable-markdown-shortcuts-in-editor")}),e.jsx(A,{checked:i.disableMarkdownShortcuts,onCheckedChange:l=>a({disableMarkdownShortcuts:l})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.content-lenght-limit")}),e.jsx(w,{className:"w-24",type:"number",defaultValue:i.contentLengthLimit,onBlur:l=>a({contentLengthLimit:Number(l.target.value)})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"truncate",children:s("setting.memo-related-settings.reactions")}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[i.reactions.map(l=>e.jsxs(Me,{variant:"outline",className:"flex items-center gap-1 h-8",children:[l,e.jsx("span",{className:"cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>a({reactions:i.reactions.filter(g=>g!==l)}),children:e.jsx(ge,{className:"w-4 h-4"})})]},l)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-32",placeholder:s("common.input"),value:r,onChange:l=>c(l.target.value.trim())}),e.jsx("span",{className:"text-muted-foreground cursor-pointer hover:text-primary",onClick:()=>d(),children:e.jsx(Ae,{className:"w-5 h-5"})})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.memo-related-settings.enable-blur-nsfw-content")}),e.jsx(A,{checked:i.enableBlurNsfwContent,onCheckedChange:l=>a({enableBlurNsfwContent:l})})]}),e.jsxs("div",{className:"mt-2 w-full flex flex-row flex-wrap gap-1",children:[i.nsfwTags.map(l=>e.jsxs(Me,{variant:"outline",className:"flex items-center gap-1 h-8",children:[l,e.jsx("span",{className:"cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>a({nsfwTags:i.nsfwTags.filter(g=>g!==l)}),children:e.jsx(ge,{className:"w-4 h-4"})})]},l)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-32",placeholder:s("common.input"),value:x,onChange:l=>h(l.target.value.trim())}),e.jsx("span",{className:"text-muted-foreground cursor-pointer hover:text-primary",onClick:()=>m(),children:e.jsx(Ae,{className:"w-5 h-5"})})]})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(N,{disabled:O(i,n),onClick:v,children:s("common.save")})})]})});function vt({open:s,onOpenChange:n,user:o,onSuccess:i}){const t=S(),[r,c]=p.useState(""),[x,h]=p.useState(""),a=()=>{n(!1)},d=l=>{const g=l.target.value;c(g)},m=l=>{const g=l.target.value;h(g)},v=async()=>{if(o){if(r===""||x===""){y.error(t("message.fill-all"));return}if(r!==x){y.error(t("message.new-password-not-match")),h("");return}try{await F.updateUser({name:o.name,password:r},["password"]),y(t("message.password-changed")),i?.(),n(!1)}catch(l){console.error(l),y.error(l.details)}}};return o?e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsxs(H,{children:[t("setting.account-section.change-password")," (",o.displayName,")"]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"newPassword",children:t("auth.new-password")}),e.jsx(w,{id:"newPassword",type:"password",placeholder:t("auth.new-password"),value:r,onChange:d})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"newPasswordAgain",children:t("auth.repeat-new-password")}),e.jsx(w,{id:"newPasswordAgain",type:"password",placeholder:t("auth.repeat-new-password"),value:x,onChange:m})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:a,children:t("common.cancel")}),e.jsx(N,{onClick:v,children:t("common.save")})]})]})}):null}function yt({open:s,onOpenChange:n,onSuccess:o}){const i=S(),t=D(),[r,c]=p.useState({avatarUrl:t.avatarUrl,username:t.username,displayName:t.displayName,email:t.email,description:t.description}),x=U.state.generalSetting,h=()=>{n(!1)},a=u=>{c(b=>({...b,...u}))},d=async u=>{const b=u.target.files;if(b&&b.length>0){const _=b[0];if(_.size>2*1024*1024){y.error("Max file size is 2MB");return}try{const G=await gs(_);a({avatarUrl:G})}catch(G){console.error(G),y.error("Failed to convert image to base64")}}},m=u=>{a({displayName:u.target.value})},v=u=>{a({username:u.target.value})},l=u=>{c(b=>({...b,email:u.target.value}))},g=u=>{c(b=>({...b,description:u.target.value}))},C=async()=>{if(r.username===""){y.error(i("message.fill-all"));return}try{const u=[];O(t.username,r.username)||u.push("username"),O(t.displayName,r.displayName)||u.push("display_name"),O(t.email,r.email)||u.push("email"),O(t.avatarUrl,r.avatarUrl)||u.push("avatar_url"),O(t.description,r.description)||u.push("description"),await F.updateUser(re.fromPartial({name:t.name,username:r.username,displayName:r.displayName,email:r.email,avatarUrl:r.avatarUrl,description:r.description}),u),y.success(i("message.update-succeed")),o?.(),n(!1)}catch(u){console.error(u),y.error(u.details)}};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:i("setting.account-section.update-information")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(k,{children:i("common.avatar")}),e.jsxs("label",{className:"relative cursor-pointer hover:opacity-80",children:[e.jsx(Ge,{className:"w-10 h-10",avatarUrl:r.avatarUrl}),e.jsx("input",{type:"file",accept:"image/*",className:"absolute invisible w-full h-full inset-0",onChange:d})]}),r.avatarUrl&&e.jsx(ge,{className:"w-4 h-auto cursor-pointer opacity-60 hover:opacity-80",onClick:()=>a({avatarUrl:""})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"username",children:[i("common.username"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.username-note"),")"]})]}),e.jsx(w,{id:"username",value:r.username,onChange:v,disabled:x.disallowChangeUsername})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"displayName",children:[i("common.nickname"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.nickname-note"),")"]})]}),e.jsx(w,{id:"displayName",value:r.displayName,onChange:m,disabled:x.disallowChangeNickname})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"email",children:[i("common.email"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",i("setting.account-section.email-note"),")"]})]}),e.jsx(w,{id:"email",type:"email",value:r.email,onChange:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"description",children:i("common.description")}),e.jsx(le,{id:"description",rows:2,value:r.description,onChange:g})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:h,children:i("common.cancel")}),e.jsx(N,{onClick:C,children:i("common.save")})]})]})})}function Nt({open:s,onOpenChange:n,onSuccess:o}){const i=S(),t=D(),[r,c]=p.useState({description:"",expiration:3600*8}),x=ve(!1),h=[{label:i("setting.access-token-section.create-dialog.duration-8h"),value:3600*8},{label:i("setting.access-token-section.create-dialog.duration-1m"),value:3600*24*30},{label:i("setting.access-token-section.create-dialog.duration-never"),value:0}],a=l=>{c({...r,...l})},d=l=>{a({description:l.target.value})},m=l=>{a({expiration:Number(l)})},v=async()=>{if(!r.description){y.error(i("message.description-is-required"));return}try{x.setLoading(),await I.createUserAccessToken({parent:t.name,accessToken:{description:r.description,expiresAt:r.expiration?new Date(Date.now()+r.expiration*1e3):void 0}}),x.setFinish(),o(),n(!1)}catch(l){y.error(l.details),console.error(l),x.setError()}};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:i("setting.access-token-section.create-dialog.create-access-token")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"description",children:[i("setting.access-token-section.create-dialog.description")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"description",type:"text",placeholder:i("setting.access-token-section.create-dialog.some-description"),value:r.description,onChange:d})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{children:[i("setting.access-token-section.create-dialog.expiration")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Ie,{value:r.expiration.toString(),onValueChange:m,className:"flex flex-row gap-4",children:h.map(l=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:l.value.toString(),id:`expiration-${l.value}`}),e.jsx(k,{htmlFor:`expiration-${l.value}`,children:l.label})]},l.value))})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:x.isLoading,onClick:()=>n(!1),children:i("common.cancel")}),e.jsx(N,{disabled:x.isLoading,onClick:v,children:i("common.create")})]})]})})}const Le=async s=>{const{accessTokens:n}=await I.listUserAccessTokens({parent:s});return n.sort((o,i)=>(i.issuedAt?.getTime()??0)-(o.issuedAt?.getTime()??0))},bt=()=>{const s=S(),n=D(),[o,i]=p.useState([]),t=Z();p.useEffect(()=>{Le(n.name).then(d=>{i(d)})},[]);const r=async()=>{const d=await Le(n.name);i(d)},c=()=>{t.open()},x=d=>{js(d),y.success(s("setting.access-token-section.access-token-copied-to-clipboard"))},h=async d=>{const m=a(d.accessToken);window.confirm(s("setting.access-token-section.access-token-deletion",{accessToken:m}))&&(await I.deleteUserAccessToken({name:d.name}),i(o.filter(l=>l.accessToken!==d.accessToken)))},a=d=>`${d.slice(0,4)}****${d.slice(-4)}`;return e.jsxs("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"sm:flex-auto space-y-1",children:[e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.access-token-section.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("setting.access-token-section.description")})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(N,{color:"primary",onClick:c,children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.token")}),e.jsx("th",{scope:"col",className:"py-2 pl-4 pr-3 text-left text-sm font-semibold text-foreground",children:s("common.description")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.create-dialog.created-at")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.access-token-section.create-dialog.expires-at")}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:o.map(d=>e.jsxs("tr",{children:[e.jsxs("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground flex flex-row justify-start items-center gap-x-1",children:[e.jsx("span",{className:"font-mono",children:a(d.accessToken)}),e.jsx(N,{variant:"ghost",onClick:()=>x(d.accessToken),children:e.jsx(Gs,{className:"w-4 h-auto text-muted-foreground"})})]}),e.jsx("td",{className:"whitespace-nowrap py-2 pl-4 pr-3 text-sm text-foreground",children:d.description}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:d.issuedAt?.toLocaleString()}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:d.expiresAt?.toLocaleString()??s("setting.access-token-section.create-dialog.duration-never")}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:e.jsx(N,{variant:"ghost",onClick:()=>{h(d)},children:e.jsx(Ce,{className:"text-destructive w-4 h-auto"})})})]},d.accessToken))})]})})})})]}),e.jsx(Nt,{open:t.isOpen,onOpenChange:t.setOpen,onSuccess:r})]})},kt=async s=>{const{sessions:n}=await I.listUserSessions({parent:s});return n.sort((o,i)=>(i.lastAccessedTime?.getTime()??0)-(o.lastAccessedTime?.getTime()??0))},Ct=()=>{const s=S(),n=D(),[o,i]=p.useState([]);p.useEffect(()=>{kt(n.name).then(a=>{i(a)})},[]);const t=async a=>{const d=r(a.sessionId);window.confirm(s("setting.user-sessions-section.session-revocation",{sessionId:d}))&&(await I.revokeUserSession({name:a.name}),i(o.filter(v=>v.sessionId!==a.sessionId)),y.success(s("setting.user-sessions-section.session-revoked")))},r=a=>`${a.slice(0,8)}...${a.slice(-8)}`,c=a=>{switch(a?.toLowerCase()){case"mobile":return e.jsx(Js,{className:"w-4 h-4 text-muted-foreground"});case"tablet":return e.jsx(et,{className:"w-4 h-4 text-muted-foreground"});case"desktop":default:return e.jsx(Xs,{className:"w-4 h-4 text-muted-foreground"})}},x=a=>{if(!a)return"Unknown Device";const d=[];return a.os&&d.push(a.os),a.browser&&d.push(a.browser),d.length>0?d.join(" • "):"Unknown Device"},h=a=>{if(o.length===0)return!1;const d=o[0];return a.sessionId===d.sessionId};return e.jsx("div",{className:"mt-6 w-full flex flex-col justify-start items-start space-y-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"sm:flex sm:items-center sm:justify-between",children:e.jsxs("div",{className:"sm:flex-auto space-y-1",children:[e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.user-sessions-section.title")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("setting.user-sessions-section.description")})]})}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:[e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.user-sessions-section.device")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.user-sessions-section.last-active")}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:o.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[c(a.clientInfo?.deviceType||""),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[x(a.clientInfo),h(a)&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary/20 text-primary",children:[e.jsx(nt,{className:"w-3 h-3 mr-1"}),s("setting.user-sessions-section.current")]})]}),e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:r(a.sessionId)})]})]})}),e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsx("span",{children:a.lastAccessedTime?.toLocaleString()})]})}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-3 pr-4 text-right text-sm",children:e.jsx(N,{variant:"ghost",disabled:h(a),onClick:()=>{t(a)},title:h(a)?s("setting.user-sessions-section.cannot-revoke-current"):s("setting.user-sessions-section.revoke-session"),children:e.jsx(Ce,{className:`w-4 h-auto ${h(a)?"text-muted-foreground":"text-destructive"}`})})})]},a.sessionId))})]}),o.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("setting.user-sessions-section.no-sessions")})]})})})]})})},St=()=>{const s=S(),n=D(),o=Z(),i=Z(),t=()=>{o.open()},r=()=>{i.open()};return e.jsxs("div",{className:"w-full gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.account-section.title")}),e.jsxs("div",{className:"w-full mt-2 flex flex-row justify-start items-center",children:[e.jsx(Ge,{className:"mr-2 shrink-0 w-10 h-10",avatarUrl:n.avatarUrl}),e.jsxs("div",{className:"max-w-[calc(100%-3rem)] flex flex-col justify-center items-start",children:[e.jsxs("p",{className:"w-full",children:[e.jsx("span",{className:"text-xl leading-tight font-medium",children:n.displayName}),e.jsxs("span",{className:"ml-1 text-base leading-tight text-muted-foreground",children:["(",n.username,")"]})]}),e.jsx("p",{className:"w-4/5 leading-tight text-sm truncate",children:n.description})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-center mt-2 space-x-2",children:[e.jsxs(N,{variant:"outline",onClick:t,children:[e.jsx(ws,{className:"w-4 h-4 mx-auto mr-1"}),s("common.edit")]}),e.jsxs(ye,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(be,{className:"w-4 h-4 mx-auto"})})}),e.jsx(ke,{align:"start",children:e.jsx(W,{onClick:r,children:s("setting.account-section.change-password")})})]})]}),e.jsx(Ct,{}),e.jsx(bt,{}),e.jsx(yt,{open:o.isOpen,onOpenChange:o.setOpen}),e.jsx(vt,{open:i.isOpen,onOpenChange:i.setOpen,user:n})]})};function Ut({open:s,onOpenChange:n,webhookName:o,onSuccess:i}){const t=S(),r=D(),[c,x]=p.useState({displayName:"",url:""}),h=ve(!1),a=o===void 0;p.useEffect(()=>{o&&r&&I.listUserWebhooks({parent:r.name}).then(g=>{const C=g.webhooks.find(u=>u.name===o);C&&x({displayName:C.displayName,url:C.url})})},[o,r]);const d=g=>{x({...c,...g})},m=g=>{d({displayName:g.target.value})},v=g=>{d({url:g.target.value})},l=async()=>{if(!c.displayName||!c.url){y.error(t("message.fill-all-required-fields"));return}if(!r){y.error("User not authenticated");return}try{h.setLoading(),a?await I.createUserWebhook({parent:r.name,webhook:{displayName:c.displayName,url:c.url}}):await I.updateUserWebhook({webhook:{name:o,displayName:c.displayName,url:c.url},updateMask:["display_name","url"]}),i?.(),n(!1),h.setFinish()}catch(g){console.error(g),y.error(g.details),h.setError()}};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:t(a?"setting.webhook-section.create-dialog.create-webhook":"setting.webhook-section.create-dialog.edit-webhook")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"displayName",children:[t("setting.webhook-section.create-dialog.title")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"displayName",type:"text",placeholder:t("setting.webhook-section.create-dialog.an-easy-to-remember-name"),value:c.displayName,onChange:m})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(k,{htmlFor:"url",children:[t("setting.webhook-section.create-dialog.payload-url")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{id:"url",type:"text",placeholder:t("setting.webhook-section.create-dialog.url-example-post-receive"),value:c.url,onChange:v})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",disabled:h.isLoading,onClick:()=>n(!1),children:t("common.cancel")}),e.jsx(N,{disabled:h.isLoading,onClick:l,children:t("common.create")})]})]})})}const It=()=>{const s=S(),n=D(),[o,i]=p.useState([]),[t,r]=p.useState(!1),c=async()=>{if(!n)return[];const{webhooks:a}=await I.listUserWebhooks({parent:n.name});return a};p.useEffect(()=>{c().then(a=>{i(a)})},[n]);const x=async()=>{const a=await c();i(a),r(!1)},h=async a=>{window.confirm(`Are you sure to delete webhook \`${a.displayName}\`? You cannot undo this action.`)&&(await I.deleteUserWebhook({name:a.name}),i(o.filter(m=>m.name!==a.name)))};return e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsx("div",{className:"flex-auto space-y-1",children:e.jsx("p",{className:"flex flex-row justify-start items-center font-medium text-muted-foreground",children:s("setting.webhook-section.title")})}),e.jsx("div",{children:e.jsx(N,{color:"primary",onClick:()=>r(!0),children:s("common.create")})})]}),e.jsx("div",{className:"w-full mt-2 flow-root",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"inline-block min-w-full border border-border rounded-lg align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("common.name")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-sm font-semibold text-foreground",children:s("setting.webhook-section.url")}),e.jsx("th",{scope:"col",className:"relative px-3 py-2 pr-4",children:e.jsx("span",{className:"sr-only",children:s("common.delete")})})]})}),e.jsxs("tbody",{className:"divide-y divide-border",children:[o.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",children:a.displayName}),e.jsx("td",{className:"max-w-[200px] px-3 py-2 text-sm text-foreground truncate",title:a.url,children:a.url}),e.jsx("td",{className:"relative whitespace-nowrap px-3 py-2 text-right text-sm",children:e.jsx(N,{variant:"ghost",onClick:()=>{h(a)},children:e.jsx(Ce,{className:"text-destructive w-4 h-auto"})})})]},a.name)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"whitespace-nowrap px-3 py-2 text-sm text-foreground",colSpan:3,children:s("setting.webhook-section.no-webhooks-found")})})]})]})})})}),e.jsx("div",{className:"w-full mt-2",children:e.jsxs(vs,{className:"text-muted-foreground text-sm inline-flex flex-row justify-start items-center hover:underline hover:text-primary",to:"https://www.usememos.com/docs/integrations/webhooks",target:"_blank",children:[s("common.learn-more"),e.jsx(Ke,{className:"inline w-4 h-auto ml-1"})]})}),e.jsx(Ut,{open:t,onOpenChange:r,onSuccess:x})]})},At=J(()=>{const s=S(),n=F.state.userGeneralSetting,o=async c=>{await F.updateUserGeneralSetting({locale:c},["locale"])},i=async c=>{await F.updateUserGeneralSetting({memoVisibility:c},["memoVisibility"])},t=async c=>{await F.updateUserGeneralSetting({theme:c},["theme"])},r=n||{locale:"en",memoVisibility:"PRIVATE",theme:"default"};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("common.language")}),e.jsx(ze,{value:r.locale,onChange:o})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.preference-section.theme")}),e.jsx(Se,{value:r.theme,onValueChange:t})]}),e.jsx("p",{className:"font-medium text-muted-foreground",children:s("setting.preference")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.preference-section.default-memo-visibility")}),e.jsxs(ee,{value:r.memoVisibility,onValueChange:i,children:[e.jsx(se,{className:"min-w-fit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{visibility:Ns(r.memoVisibility)}),e.jsx(te,{})]})}),e.jsx(ae,{children:[me.PRIVATE,me.PROTECTED,me.PUBLIC].map(c=>bs(c)).map(c=>e.jsx(V,{value:c,className:"whitespace-nowrap",children:s(`memo.visibility.${c.toLowerCase()}`)},c))})]})]}),e.jsx(X,{className:"my-3"}),e.jsx(It,{})]})}),he=[{name:"",title:"GitHub",type:L.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",scopes:["read:user"],fieldMapping:Y.fromPartial({identifier:"login",displayName:"name",email:"email"})}}},{name:"",title:"GitLab",type:L.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://gitlab.com/oauth/authorize",tokenUrl:"https://gitlab.com/oauth/token",userInfoUrl:"https://gitlab.com/oauth/userinfo",scopes:["openid"],fieldMapping:Y.fromPartial({identifier:"name",displayName:"name",email:"email"})}}},{name:"",title:"Google",type:L.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],fieldMapping:Y.fromPartial({identifier:"email",displayName:"name",email:"email"})}}},{name:"",title:"Custom",type:L.OAUTH2,identifierFilter:"",config:{oauth2Config:{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}}}];function Pt({open:s,onOpenChange:n,identityProvider:o,onSuccess:i}){const t=S(),r=[...new Set(he.map(f=>f.type))],[c,x]=p.useState({title:"",identifierFilter:""}),[h,a]=p.useState(L.OAUTH2),[d,m]=p.useState({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}),[v,l]=p.useState(""),[g,C]=p.useState("GitHub"),u=o===void 0;p.useEffect(()=>{s||(x({title:"",identifierFilter:""}),a(L.OAUTH2),m({clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:Y.fromPartial({identifier:"",displayName:"",email:""})}),l(""),C("GitHub"))},[s]),p.useEffect(()=>{if(s&&o&&(x({title:o.title,identifierFilter:o.identifierFilter}),a(o.type),o.type===L.OAUTH2)){const f=Pe.fromPartial(o.config?.oauth2Config||{});m(f),l(f.scopes.join(" "))}},[s,o]),p.useEffect(()=>{if(!u||!s)return;const f=he.find(j=>j.title===g);if(f&&(x({title:f.title,identifierFilter:f.identifierFilter}),a(f.type),f.type===L.OAUTH2)){const j=Pe.fromPartial(f.config?.oauth2Config||{});m(j),l(j.scopes.join(" "))}},[g,u,s]);const b=()=>{n(!1)},_=()=>!(c.title===""||h==="OAUTH2"&&(d.clientId===""||d.authUrl===""||d.tokenUrl===""||d.userInfoUrl===""||v===""||d.fieldMapping?.identifier===""||u&&d.clientSecret==="")),G=async()=>{try{u?(await ne.createIdentityProvider({identityProvider:{...c,type:h,config:{oauth2Config:{...d,scopes:v.split(" ")}}}}),y.success(t("setting.sso-section.sso-created",{name:c.title}))):(await ne.updateIdentityProvider({identityProvider:{...c,name:o.name,type:h,config:{oauth2Config:{...d,scopes:v.split(" ")}}},updateMask:["title","identifier_filter","config"]}),y.success(t("setting.sso-section.sso-updated",{name:c.title})))}catch(f){y.error(f.details),console.error(f)}i?.(),n(!1)},R=f=>{m({...d,...f})};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(H,{children:t(u?"setting.sso-section.create-sso":"setting.sso-section.update-sso")})}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full space-y-4",children:[u&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-1!",children:t("common.type")}),e.jsxs(ee,{value:String(h),onValueChange:f=>a(parseInt(f)),children:[e.jsx(se,{className:"w-full mb-4",children:e.jsx(te,{})}),e.jsx(ae,{children:r.map(f=>e.jsx(V,{value:String(f),children:L[f]||f},f))})]}),e.jsx("p",{className:"mb-2 text-sm font-medium",children:t("setting.sso-section.template")}),e.jsxs(ee,{value:g,onValueChange:f=>C(f),children:[e.jsx(se,{className:"mb-1 h-auto w-full",children:e.jsx(te,{})}),e.jsx(ae,{children:he.map(f=>e.jsx(V,{value:f.title,children:f.title},f.title))})]}),e.jsx(X,{className:"my-2"})]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("common.name"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("common.name"),value:c.title,onChange:f=>x({...c,title:f.target.value})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("setting.sso-section.identifier-filter")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.identifier-filter"),value:c.identifierFilter,onChange:f=>x({...c,identifierFilter:f.target.value})}),e.jsx(X,{className:"my-2"}),h==="OAUTH2"&&e.jsxs(e.Fragment,{children:[u&&e.jsxs("p",{className:"border border-border rounded-md p-2 text-sm w-full mb-2 break-all",children:[t("setting.sso-section.redirect-url"),": ",ks("/auth/callback")]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.client-id"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.client-id"),value:d.clientId,onChange:f=>R({clientId:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.client-secret"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.client-secret"),value:d.clientSecret,onChange:f=>R({clientSecret:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.authorization-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.authorization-endpoint"),value:d.authUrl,onChange:f=>R({authUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.token-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.token-endpoint"),value:d.tokenUrl,onChange:f=>R({tokenUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.user-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.user-endpoint"),value:d.userInfoUrl,onChange:f=>R({userInfoUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.scopes"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.scopes"),value:v,onChange:f=>l(f.target.value)}),e.jsx(X,{className:"my-2"}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[t("setting.sso-section.identifier"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.identifier"),value:d.fieldMapping.identifier,onChange:f=>R({fieldMapping:{...d.fieldMapping,identifier:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("setting.sso-section.display-name")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("setting.sso-section.display-name"),value:d.fieldMapping.displayName,onChange:f=>R({fieldMapping:{...d.fieldMapping,displayName:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:t("common.email")}),e.jsx(w,{className:"mb-2 w-full",placeholder:t("common.email"),value:d.fieldMapping.email,onChange:f=>R({fieldMapping:{...d.fieldMapping,email:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:"Avatar URL"}),e.jsx(w,{className:"mb-2 w-full",placeholder:"Avatar URL",value:d.fieldMapping.avatarUrl,onChange:f=>R({fieldMapping:{...d.fieldMapping,avatarUrl:f.target.value}})})]})]}),e.jsxs(q,{children:[e.jsx(N,{variant:"ghost",onClick:b,children:t("common.cancel")}),e.jsx(N,{onClick:G,disabled:!_(),children:t(u?"common.create":"common.update")})]})]})})}const Tt=s=>{const{className:n,url:o,title:i}=s,t=S();return e.jsx(We,{children:e.jsxs(Be,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx("a",{className:`text-muted-foreground hover:text-primary ${n}`,href:o,target:"_blank",children:e.jsx(Ke,{className:"w-4 h-auto"})})}),e.jsx($e,{children:e.jsx("p",{children:i??t("common.learn-more")})})]})})},Rt=()=>{const s=S(),[n,o]=p.useState([]),[i,t]=p.useState(!1),[r,c]=p.useState();p.useEffect(()=>{x()},[]);const x=async()=>{const{identityProviders:l}=await ne.listIdentityProviders({});o(l)},h=async l=>{if(window.confirm(s("setting.sso-section.confirm-delete",{name:l.title}))){try{await ne.deleteIdentityProvider({name:l.name})}catch(C){console.error(C),y.error(C.details)}await x()}},a=()=>{c(void 0),t(!0)},d=l=>{c(l),t(!0)},m=async()=>{await x(),t(!1),c(void 0)},v=l=>{t(l),l||c(void 0)};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[e.jsx("span",{className:"font-mono text-muted-foreground",children:s("setting.sso-section.sso-list")}),e.jsx(Tt,{url:"https://www.usememos.com/docs/configuration/authentication"})]}),e.jsx(N,{color:"primary",onClick:a,children:s("common.create")})]}),e.jsx(X,{}),n.map(l=>e.jsxs("div",{className:"py-2 w-full border-b last:border-b border-border flex flex-row items-center justify-between",children:[e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs("p",{className:"ml-2",children:[l.title,e.jsxs("span",{className:"text-sm ml-1 text-muted-foreground",children:["(",l.type,")"]})]})}),e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs(ye,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(be,{className:"w-4 h-auto"})})}),e.jsxs(ke,{align:"end",sideOffset:2,children:[e.jsx(W,{onClick:()=>d(l),children:s("common.edit")}),e.jsx(W,{onClick:()=>h(l),children:s("common.delete")})]})]})})]},l.name)),n.length===0&&e.jsx("div",{className:"w-full mt-2 text-sm border-border text-muted-foreground flex flex-row items-center justify-between",children:e.jsx("p",{className:"",children:s("setting.sso-section.no-sso-found")})}),e.jsx(Pt,{open:i,onOpenChange:v,identityProvider:r,onSuccess:m})]})},De=({text:s,icon:n,isSelected:o,onClick:i})=>e.jsxs("div",{onClick:i,className:`w-auto max-w-full px-3 leading-8 flex flex-row justify-start items-center cursor-pointer rounded-lg select-none hover:opacity-80 ${o?"bg-accent shadow":""}`,children:[e.jsx(n,{className:"w-4 h-auto mr-2 opacity-80 shrink-0"}),e.jsx("span",{className:"truncate",children:s})]}),Et=J(()=>{const s=S(),[n,o]=p.useState(ue.fromPartial(U.getWorkspaceSettingByKey(P.STORAGE)?.storageSetting||{}));p.useEffect(()=>{o(ue.fromPartial(U.getWorkspaceSettingByKey(P.STORAGE)?.storageSetting||{}))},[U.getWorkspaceSettingByKey(P.STORAGE)]);const i=p.useMemo(()=>{if(n.uploadSizeLimitMb<=0)return!1;const j=ue.fromPartial(U.getWorkspaceSettingByKey(P.STORAGE)?.storageSetting||{});if(n.storageType===M.LOCAL){if(n.filepathTemplate.length===0)return!1}else if(n.storageType===M.S3){if(n.s3Config?.accessKeyId.length===0||n.s3Config?.accessKeySecret.length===0||n.s3Config?.endpoint.length===0||n.s3Config?.region.length===0||n.s3Config?.bucket.length===0)return!1}else if(n.storageType===M.ALIYUN_OSS&&(!n.ossConfig?.accessKeyId||!n.ossConfig?.accessKeySecret||!n.ossConfig?.endpoint||!n.ossConfig?.region||!n.ossConfig?.bucket))return!1;return!O(j,n)},[n,U.state]),t=async j=>{let E=parseInt(j.target.value);Number.isNaN(E)&&(E=0);const is={...n,uploadSizeLimitMb:E};o(is)},r=async j=>{const E={...n,filepathTemplate:j.target.value};o(E)},c=async j=>{const E={...n,s3Config:Cs.fromPartial({...n.s3Config,...j})};o(E)},x=async j=>{c({accessKeyId:j.target.value})},h=async j=>{c({accessKeySecret:j.target.value})},a=async j=>{c({endpoint:j.target.value})},d=async j=>{c({region:j.target.value})},m=async j=>{c({bucket:j.target.value})},v=j=>{c({usePathStyle:j.target.checked})},l=async j=>{const E={...n,ossConfig:{...n.ossConfig,...j}};o(E)},g=async j=>{l({endpoint:j.target.value})},C=async j=>{l({region:j.target.value})},u=async j=>{l({accessKeyId:j.target.value})},b=async j=>{l({accessKeySecret:j.target.value})},_=async j=>{l({bucket:j.target.value})},G=j=>{l({useSsl:j})},R=async j=>{const E={...n,storageType:j};o(E)},f=async()=>{await U.upsertWorkspaceSetting({name:`${ce}${P.STORAGE}`,storageSetting:n}),y.success("Updated")};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("div",{className:"font-medium text-muted-foreground",children:s("setting.storage-section.current-storage")}),e.jsxs(Ie,{value:n.storageType,onValueChange:j=>{R(j)},className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:M.DATABASE,id:"database"}),e.jsx(k,{htmlFor:"database",children:s("setting.storage-section.type-database")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:M.LOCAL,id:"local"}),e.jsx(k,{htmlFor:"local",children:s("setting.storage-section.type-local")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:M.S3,id:"s3"}),e.jsx(k,{htmlFor:"s3",children:"S3"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:M.ALIYUN_OSS,id:"aliyun_oss"}),e.jsx(k,{htmlFor:"aliyun_oss",children:s("setting.storage-section.type-aliyun-oss")})]})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.system-section.max-upload-size")}),e.jsx(We,{children:e.jsxs(Be,{children:[e.jsx(Ve,{children:e.jsx(Ds,{className:"w-4 h-auto"})}),e.jsx($e,{children:e.jsx("p",{children:s("setting.system-section.max-upload-size-hint")})})]})})]}),e.jsx(w,{className:"w-16 font-mono",value:n.uploadSizeLimitMb,onChange:t})]}),n.storageType!==M.DATABASE&&e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.filepath-template")}),e.jsx(w,{className:"w-64",value:n.filepathTemplate,placeholder:"assets/{timestamp}_{filename}",onChange:r})]}),n.storageType===M.S3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Access key id"}),e.jsx(w,{className:"w-64",value:n.s3Config?.accessKeyId,placeholder:"",onChange:x})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Access key secret"}),e.jsx(w,{className:"w-64",value:n.s3Config?.accessKeySecret,placeholder:"",onChange:h})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Endpoint"}),e.jsx(w,{className:"w-64",value:n.s3Config?.endpoint,placeholder:"",onChange:a})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Region"}),e.jsx(w,{className:"w-64",value:n.s3Config?.region,placeholder:"",onChange:d})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Bucket"}),e.jsx(w,{className:"w-64",value:n.s3Config?.bucket,placeholder:"",onChange:m})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:"Use Path Style"}),e.jsx(A,{checked:n.s3Config?.usePathStyle,onCheckedChange:j=>v({target:{checked:j}})})]})]}),n.storageType===M.ALIYUN_OSS&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-endpoint")}),e.jsx(w,{className:"w-64",value:n.ossConfig?.endpoint||"",placeholder:"oss-cn-hangzhou.aliyuncs.com",onChange:g})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-region")}),e.jsx(w,{className:"w-64",value:n.ossConfig?.region||"",placeholder:"cn-hangzhou",onChange:C})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-access-key-id")}),e.jsx(w,{className:"w-64",value:n.ossConfig?.accessKeyId||"",placeholder:"LTAI5t...",onChange:u})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-access-key-secret")}),e.jsx(w,{className:"w-64",type:"password",value:n.ossConfig?.accessKeySecret||"",placeholder:"••••••••",onChange:b})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-bucket")}),e.jsx(w,{className:"w-64",value:n.ossConfig?.bucket||"",placeholder:"memos-attachments",onChange:_})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground mr-1",children:s("setting.storage-section.oss-use-ssl")}),e.jsx(A,{checked:n.ossConfig?.useSsl!==!1,onCheckedChange:G})]})]}),e.jsx("div",{children:e.jsx(N,{disabled:!i,onClick:f,children:s("common.save")})})]})});function Mt({open:s,onOpenChange:n,onSuccess:o}){const i=S(),t=U.state.generalSetting,[r,c]=p.useState(Ss.fromPartial(t.customProfile||{})),[x,h]=p.useState(!1),a=b=>{c(_=>({..._,...b}))},d=b=>{a({title:b.target.value})},m=b=>{a({logoUrl:b.target.value})},v=b=>{a({description:b.target.value})},l=b=>{a({locale:b})},g=()=>{a({title:"Memos",logoUrl:"/logo.webp",description:"",locale:"en"})},C=()=>{n(!1)},u=async()=>{if(r.title===""){y.error("Title cannot be empty.");return}h(!0);try{await U.upsertWorkspaceSetting({name:`${ce}${P.GENERAL}`,generalSetting:{...t,customProfile:r}}),y.success(i("message.update-succeed")),o?.(),n(!1)}catch(b){console.error(b),y.error("Failed to update profile")}finally{h(!1)}};return e.jsx($,{open:s,onOpenChange:n,children:e.jsxs(z,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(H,{children:i("setting.system-section.customize-server.title")}),e.jsx(Us,{children:"Customize your workspace appearance and settings."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"server-name",children:i("setting.system-section.server-name")}),e.jsx(w,{id:"server-name",type:"text",value:r.title,onChange:d,placeholder:"Enter server name"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"icon-url",children:i("setting.system-section.customize-server.icon-url")}),e.jsx(w,{id:"icon-url",type:"text",value:r.logoUrl,onChange:m,placeholder:"Enter icon URL"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"description",children:i("setting.system-section.customize-server.description")}),e.jsx(le,{id:"description",rows:3,value:r.description,onChange:v,placeholder:"Enter description"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:i("setting.system-section.customize-server.locale")}),e.jsx(ze,{value:r.locale,onChange:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Theme"}),e.jsx(Se,{})]})]}),e.jsxs(q,{className:"flex-col sm:flex-row sm:justify-between gap-2",children:[e.jsx(N,{variant:"outline",onClick:g,disabled:x,className:"sm:mr-auto",children:i("common.restore")}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(N,{variant:"ghost",onClick:C,disabled:x,className:"flex-1 sm:flex-initial",children:i("common.cancel")}),e.jsx(N,{onClick:u,disabled:x,className:"flex-1 sm:flex-initial",children:x?"Saving...":i("common.save")})]})]})]})})}const Lt=J(()=>{const s=S(),n=Z(),o=Te.fromPartial(U.getWorkspaceSettingByKey(P.GENERAL)?.generalSetting||{}),[i,t]=p.useState(o),[r,c]=p.useState([]);p.useEffect(()=>{t({...i,customProfile:o.customProfile})},[U.getWorkspaceSettingByKey(P.GENERAL)]);const x=()=>{n.open()},h=m=>{t(Te.fromPartial({...i,...m}))},a=async()=>{try{await U.upsertWorkspaceSetting({name:`${ce}${P.GENERAL}`,generalSetting:i})}catch(m){y.error(m.details),console.error(m);return}y.success(s("message.update-succeed"))};p.useEffect(()=>{d()},[]);const d=async()=>{const{identityProviders:m}=await ne.listIdentityProviders({});c(m)};return e.jsxs("div",{className:"w-full flex flex-col gap-2 pt-2 pb-4",children:[e.jsx("p",{className:"font-medium text-foreground",children:s("common.basic")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsxs("div",{children:[s("setting.system-section.server-name"),":"," ",e.jsx("span",{className:"font-mono font-bold",children:i.customProfile?.title||"Memos"})]}),e.jsx(N,{variant:"outline",onClick:x,children:s("common.edit")})]}),e.jsx(X,{}),e.jsx("p",{className:"font-medium text-foreground",children:s("setting.system-section.title")}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:"Theme"}),e.jsx(Se,{value:i.theme||"default",onValueChange:m=>h({theme:m}),className:"min-w-fit"})]}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-style")})}),e.jsx(le,{className:"font-mono w-full",rows:3,placeholder:s("setting.system-section.additional-style-placeholder"),value:i.additionalStyle,onChange:m=>h({additionalStyle:m.target.value})}),e.jsx("div",{className:"w-full flex flex-row justify-between items-center",children:e.jsx("span",{children:s("setting.system-section.additional-script")})}),e.jsx(le,{className:"font-mono w-full",rows:3,placeholder:s("setting.system-section.additional-script-placeholder"),value:i.additionalScript,onChange:m=>h({additionalScript:m.target.value})}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-user-registration")}),e.jsx(A,{disabled:U.state.profile.mode==="demo",checked:i.disallowUserRegistration,onCheckedChange:m=>h({disallowUserRegistration:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-password-auth")}),e.jsx(A,{disabled:U.state.profile.mode==="demo"||r.length===0&&!i.disallowPasswordAuth,checked:i.disallowPasswordAuth,onCheckedChange:m=>h({disallowPasswordAuth:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-username")}),e.jsx(A,{checked:i.disallowChangeUsername,onCheckedChange:m=>h({disallowChangeUsername:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{children:s("setting.workspace-section.disallow-change-nickname")}),e.jsx(A,{checked:i.disallowChangeNickname,onCheckedChange:m=>h({disallowChangeNickname:m})})]}),e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"truncate",children:s("setting.workspace-section.week-start-day")}),e.jsxs(ee,{value:i.weekStartDayOffset.toString(),onValueChange:m=>{h({weekStartDayOffset:parseInt(m)||0})},children:[e.jsx(se,{className:"min-w-fit",children:e.jsx(te,{})}),e.jsxs(ae,{children:[e.jsx(V,{value:"-1",children:s("setting.workspace-section.saturday")}),e.jsx(V,{value:"0",children:s("setting.workspace-section.sunday")}),e.jsx(V,{value:"1",children:s("setting.workspace-section.monday")})]})]})]}),e.jsx("div",{className:"mt-2 w-full flex justify-end",children:e.jsx(N,{disabled:O(i,o),onClick:a,children:s("common.save")})}),e.jsx(Mt,{open:n.isOpen,onOpenChange:n.setOpen,onSuccess:()=>{y.success("Profile updated successfully!")}})]})}),xe=["my-account","preference"],pe=["member","system","memo-related","storage","sso"],_e={"my-account":tt,preference:$s,member:Es,system:Rs,"memo-related":Ts,storage:Ks,sso:qs},Vt=J(()=>{const s=S(),{md:n}=Is(),o=As(),i=D(),[t,r]=p.useState({selectedSection:"my-account"}),c=i.role===Q.HOST,x=p.useMemo(()=>{let a=[...xe];return c&&(a=a.concat(pe)),a},[c]);p.useEffect(()=>{let a=o.hash.slice(1);[...xe,...pe].includes(a)||(a="my-account"),r({selectedSection:a})},[o.hash]),p.useEffect(()=>{c&&(async()=>[P.MEMO_RELATED,P.STORAGE].forEach(async a=>{await U.fetchWorkspaceSetting(a)}))()},[c]);const h=p.useCallback(a=>{window.location.hash=a},[]);return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-start sm:pt-3 md:pt-6 pb-8",children:[!n&&e.jsx(Ps,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-row justify-start items-start px-4 py-3 rounded-xl bg-background text-muted-foreground",children:[e.jsxs("div",{className:"hidden sm:flex flex-col justify-start items-start w-40 h-auto shrink-0 py-2",children:[e.jsx("span",{className:"text-sm mt-0.5 pl-3 font-mono select-none text-muted-foreground",children:s("common.basic")}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:xe.map(a=>e.jsx(De,{text:s(`setting.${a}`),icon:_e[a],isSelected:t.selectedSection===a,onClick:()=>h(a)},a))}),c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm mt-4 pl-3 font-mono select-none text-muted-foreground",children:s("common.admin")}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:[pe.map(a=>e.jsx(De,{text:s(`setting.${a}`),icon:_e[a],isSelected:t.selectedSection===a,onClick:()=>h(a)},a)),e.jsxs("span",{className:"px-3 mt-2 opacity-70 text-sm",children:[s("setting.version"),": v",U.state.profile.version]})]})]}):null]}),e.jsxs("div",{className:"w-full grow sm:pl-4 overflow-x-auto",children:[e.jsx("div",{className:"w-auto inline-block my-2 sm:hidden",children:e.jsxs(ee,{value:t.selectedSection,onValueChange:a=>h(a),children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(te,{placeholder:"Select section"})}),e.jsx(ae,{children:x.map(a=>e.jsx(V,{value:a,children:s(`setting.${a}`)},a))})]})}),t.selectedSection==="my-account"?e.jsx(St,{}):t.selectedSection==="preference"?e.jsx(At,{}):t.selectedSection==="member"?e.jsx(gt,{}):t.selectedSection==="system"?e.jsx(Lt,{}):t.selectedSection==="memo-related"?e.jsx(wt,{}):t.selectedSection==="storage"?e.jsx(Et,{}):t.selectedSection==="sso"?e.jsx(Rt,{}):null]})]})})]})});export{Vt as default};
