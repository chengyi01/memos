import{o as y,u as g,k as v,b as N,q as u,r as b,j as e,l as A,s as T,t as S,I as k,E as C,x as E,A as h,y as D,T as F,z as M,C as B,B as Q,D as Y,F as I}from"./index.js";import{d as i}from"./mermaid-vendor.js";import{r as x}from"./leaflet-vendor.js";import{b as L}from"./utils-vendor.js";import"./katex-vendor.js";function P(r){const c=new Map;return r.sort((l,t)=>i(t.createTime).unix()-i(l.createTime).unix()).forEach(l=>{const t=i(l.createTime).format("YYYY-MM");c.has(t)||c.set(t,[]),c.get(t)?.push(l)}),c}const O=y(()=>{const r=g(),{md:c}=v(),l=N(),[t,j]=x.useState({searchQuery:""}),[d,f]=x.useState([]),o=d.filter(s=>L(s.filename,t.searchQuery)),p=P(o.filter(s=>s.memo)),n=o.filter(s=>!s.memo);x.useEffect(()=>{u.listAttachments({}).then(({attachments:s})=>{f(s),l.setFinish(),Promise.all(s.map(a=>a.memo?b.getOrFetchMemoByName(a.memo):null))})},[]);const w=async()=>{if(window.confirm("Are you sure to delete all unused attachments? This action cannot be undone.")){for(const a of n)await u.deleteAttachment({name:a.name});f(d.filter(a=>a.memo))}};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!c&&e.jsx(A,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-background text-foreground",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(T,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:r("common.attachments")})]}),e.jsx("div",{children:e.jsxs("div",{className:"relative max-w-32",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(k,{className:"pl-9",placeholder:r("common.search"),value:t.searchQuery,onChange:s=>j({...t,searchQuery:s.target.value})})]})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:l.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:r("resource.fetching-data")})}):e.jsx(e.Fragment,{children:o.length===0?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(C,{}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:r("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(p.entries()).map(([s,a])=>e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:i(s).year()}),e.jsx("span",{className:"font-medium text-xl",children:i(s).toDate().toLocaleString(E.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:a.map(m=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(h,{attachment:m,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:m.filename})})]},m.name))})]},s)),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:r("resource.unused-resources")}),e.jsxs("span",{className:"text-muted-foreground opacity-80",children:["(",n.length,")"]}),e.jsx(F,{children:e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(Q,{variant:"ghost",size:"sm",onClick:w,children:e.jsx(Y,{className:"w-4 h-auto opacity-60"})})}),e.jsx(I,{children:e.jsx("p",{children:"Delete all"})})]})})]}),n.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(h,{attachment:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:s.filename})})]},s.name))]})]})]})]})})})]})})]})});export{O as default};
