import{o as p,u as w,l as y,b as N,r as v,s as g,j as e,p as b,t as A,x as S,I as E,E as k,y as M,A as f,z as F}from"./index.js";import{d as c}from"./mermaid-vendor.js";import{r as x}from"./leaflet-vendor.js";import{b as Q}from"./utils-vendor.js";import"./katex-vendor.js";function T(a){const l=new Map;return a.sort((r,t)=>c(t.createTime).unix()-c(r.createTime).unix()).forEach(r=>{const t=c(r.createTime).format("YYYY-MM");l.has(t)||l.set(t,[]),l.get(t)?.push(r)}),l}const C=p(()=>{const a=w(),{md:l}=y(),r=N(),[t,d]=x.useState({searchQuery:""}),[u,h]=x.useState([]),m=u.filter(s=>Q(s.filename,t.searchQuery)),j=T(m.filter(s=>s.memo)),n=m.filter(s=>!s.memo);return x.useEffect(()=>{v.listAttachments({}).then(({attachments:s})=>{h(s),r.setFinish(),Promise.all(s.map(i=>i.memo?g.getOrFetchMemoByName(i.memo):null))})},[]),e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!l&&e.jsx(b,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-background text-foreground",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(A,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:a("common.attachments")})]}),e.jsx("div",{children:e.jsxs("div",{className:"relative max-w-32",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{className:"pl-9",placeholder:a("common.search"),value:t.searchQuery,onChange:s=>d({...t,searchQuery:s.target.value})})]})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:r.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:a("resource.fetching-data")})}):e.jsx(e.Fragment,{children:m.length===0?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(k,{}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:a("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(j.entries()).map(([s,i])=>e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:c(s).year()}),e.jsx("span",{className:"font-medium text-xl",children:c(s).toDate().toLocaleString(M.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:i.map(o=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(f,{attachment:o,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:o.filename})})]},o.name))})]},s)),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:a("resource.unused-resources")}),e.jsxs("span",{className:"text-muted-foreground opacity-80",children:["(",n.length,")"]})]}),n.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(f,{attachment:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:s.filename})})]},s.name))]})]})]})]})})})]})})]})});export{C as default};
